{"sandbox_archive_version":45,"resources":[{"default":[]},{"autogenerated":[]}],"resourceCart":[{"guid":[1101897418,2507817835,3094537286,1546502699],"name":"Local","parentGuid":[0,0,0,0],"type":"kGeneric","preload":false},{"guid":[20081327,3811722658,2346874489,3237291753],"name":"Global","parentGuid":[0,0,0,0],"type":"kGeneric","preload":false}],"mapdata":[{"ObjectsLinker":[{"class":"cWorkspace","name":"Archetypes","guid":[2301495294,1274365006,3003438828,1864040556],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cPlayerInstance","name":"Local","guid":[821939657,2231651804,3205518288,3133023722],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cBlackholeFolderObject","name":"Local","guid":[417325223,2932100337,2430726746,1418825083],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cUiScreenUiObject","name":"ScreenGUI","guid":[2288685280,129189584,3004433564,697975946],"spaceId":"kArchetypeSpace","objectType":-842150451},{"class":"cUiFigureObject","name":"TouchFigure","guid":[2197565629,1415203114,2823922405,1734351976],"spaceId":"kArchetypeSpace","objectType":-842150451},{"class":"cScriptObject","name":"Script","guid":[994673966,4158342735,2276802114,1552768072],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cUiButtonObject","name":"JumpButton","guid":[102160580,854410432,2549292484,1202403965],"spaceId":"kArchetypeSpace","objectType":-842150451},{"class":"cScriptObject","name":"Script","guid":[1268784625,3114224356,2978109736,848837611],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cUiJoystickObject","name":"Joystick","guid":[214363713,4292497295,3028021729,2005335375],"spaceId":"kArchetypeSpace","objectType":-842150451},{"class":"cConstraintFreeObject","name":"ConstraintFree","guid":[2664149892,2599504529,2239431142,2444569089],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cPrimitiveObject","name":"Cube","guid":[3975424097,1952858743,3124273456,2934115946],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cCamera","name":"GameCamera","guid":[759347957,2245412439,2215380327,3955432270],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cFolderObject","name":"C_Code","guid":[1988763669,642008485,3045610516,4157666106],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cScriptObject","name":"PlayerControlScript","guid":[1560065165,549536527,2196214773,3289613067],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cScriptObject","name":"PlayerMain","guid":[1590936490,2974695715,2831162716,2733380204],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cNodeObject","name":"localPlayer","guid":[2229867806,259017539,2476631306,1972820229],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cPlayerInstance","name":"Player","guid":[3921698427,2579318821,3172122006,1001323442],"spaceId":"kArchetypeSpace","objectType":-220201056},{"class":"cPlayerAvatarInstance","name":"Avatar","guid":[2086577372,1035157785,2412732698,2224839101],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cBoneAnchor","name":"Bone_Head","guid":[1952377286,2257011431,2235437585,1990350708],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cBoneAnchor","name":"Bone_R_Hand","guid":[1365265308,2584495651,3179854900,2314059387],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cBoneAnchor","name":"Bone_L_Hand","guid":[1001141281,105596195,2413995681,1572381856],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cBoneAnchor","name":"Bone_Pelvis","guid":[3930266631,3765193548,2657671196,2444667291],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cBoneAnchor","name":"Bone_R_Foot","guid":[1011560467,1551582414,3132691223,44035332],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cBoneAnchor","name":"Bone_L_Foot","guid":[3538847244,808075570,2480843790,1198870357],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cUiSurfaceUiObject","name":"NameGUI","guid":[1405111285,2384023431,3182972373,2500518680],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cUiTextObject","name":"NameBar","guid":[3515521018,3624552389,2321875400,3242185261],"spaceId":"kArchetypeSpace","objectType":-842150451},{"class":"cScriptObject","name":"Script","guid":[3648344019,2319469073,2373482710,1056499623],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cUiSurfaceUiObject","name":"HealthGUI","guid":[1362459126,1156792341,2681269783,824873225],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cUiImageObject","name":"BackGround","guid":[2692120497,1768836605,2660612515,4269796384],"spaceId":"kArchetypeSpace","objectType":-842150451},{"class":"cUiImageObject","name":"Health","guid":[3177680961,308758981,2341371969,3691269346],"spaceId":"kArchetypeSpace","objectType":-842150451},{"class":"cScriptObject","name":"Script","guid":[4158487454,792609324,3178147409,2519421303],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cFolderObject","name":"C_Event","guid":[2292071358,1506495263,2198482554,1903889976],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cCustomEventObject","name":"ClientExample01Event","guid":[2692906001,400442409,2471841936,3656382497],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cCustomEventObject","name":"ClientExample02Event","guid":[4280271411,1924088491,2838919974,2621789847],"spaceId":"kArchetypeSpace","objectType":0},{"class":"cCustomEventObject","name":"ClientExample03Event","guid":[1505293026,2520205713,2880716936,3351337845],"spaceId":"kArchetypeSpace","objectType":0}],"ObjectsData":[{"class":"cWorkspace","name":"Archetypes","guid":[2301495294,1274365006,3003438828,1864040556],"parentGuid":[0,0,0,0],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Archetypes"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sWorkspaceComponent","data":{}},{"id":11,"class":"sConfigPhysicsComponent","data":{"m_collisionGroupMaskFlags":[0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}]},{"class":"cPlayerInstance","name":"Local","guid":[821939657,2231651804,3205518288,3133023722],"parentGuid":[2301495294,1274365006,3003438828,1864040556],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Local"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sRigidBodyComponent","data":{"m_isStatic":false,"m_density":1000.0,"m_frictionRate":0.0,"m_rough":0.0,"m_restitution":0.0,"m_freezeRotation":true,"m_gravityScale":2.0}},{"id":20,"class":"sCharacterControllerComponent","data":{"m_jumpUpVelocity":9.800000190734864}},{"id":40,"class":"sCharacterStateComponent","data":{"m_respawnTime":3.0,"m_avatar":[2086577372,1035157785,2412732698,2224839101],"m_displayName":true}},{"id":50,"class":"sRenderComponent","data":{}},{"id":60,"class":"sNetworkComponent","data":{}},{"id":666,"class":"sStateSyncComponent","data":{"m_syncRotation":[0.0,0.0,0.0,1.0],"m_distrSimVersion":0}}]},{"class":"cBlackholeFolderObject","name":"Local","guid":[417325223,2932100337,2430726746,1418825083],"parentGuid":[821939657,2231651804,3205518288,3133023722],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Local"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cUiScreenUiObject","name":"ScreenGUI","guid":[2288685280,129189584,3004433564,697975946],"parentGuid":[417325223,2932100337,2430726746,1418825083],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ScreenGUI"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":26,"class":"sUiScreenUiComponent","data":{"m_widgetSize":[1920.0,1080.0],"m_order":1,"m_pivot":[0.0,0.0],"m_anchorsX":[0.0,0.0],"m_anchorsY":[0.0,0.0],"m_anchor":"kAlignBottomLeft","m_anchorPercent":[0.0,0.0],"m_alignment":"kAlignBottomLeft","m_alignmentPercent":[0.0,0.0],"m_preSize":[1229.0,629.0]}}]},{"class":"cUiFigureObject","name":"TouchFigure","guid":[2197565629,1415203114,2823922405,1734351976],"parentGuid":[2288685280,129189584,3004433564,697975946],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"TouchFigure"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":24,"class":"sUiFigureComponent","data":{"m_addedSize":[200.0,200.0],"m_widgetSize":[2208.957763671875,1359.394775390625],"m_order":1,"m_pivot":[0.0,0.0],"m_anchorsX":[0.0,1.0],"m_anchorsY":[0.0,1.0],"m_anchor":"kAlignBottomLeft","m_anchorPercent":[0.0,0.0],"m_alignment":"kAlignBottomLeft","m_alignmentPercent":[0.0,0.0],"m_preSize":[2208.957763671875,1359.394775390625],"m_prePivot":[0.0,0.0],"m_preAnchorsX":[0.0,1.0],"m_preAnchorsY":[0.0,1.0],"m_finalSize":[2200.0,1264.0712890625],"m_autoScale":true,"m_autoScaleType":"ByParentScale","m_bgColor":[1.0,1.0,1.0,0.0],"m_borderColor":[0.0,0.0,0.0,0.0]}}]},{"class":"cScriptObject","name":"Script","guid":[994673966,4158342735,2276802114,1552768072],"parentGuid":[2197565629,1415203114,2823922405,1734351976],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Script"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"TouchNumber=0\r\nfunction cameraMove(pos,dis,deltapos,speed)\r\n\tlocal Camera = world.CurrentCamera\r\n\tif ((Camera.CameraMode==1 and Camera.Distance>0) or Camera.CameraMode==5) and TouchNumber==1 then\r\n\t\tCamera:CameraMove(deltapos)\r\n\telseif ((Camera.CameraMode==1 and Camera.Distance<0) or Camera.CameraMode==2 or Camera.CameraMode==3) and TouchNumber==1 then\r\n\t\tlocalPlayer:RotateAround(localPlayer.Position,Camera.UpVector,deltapos.x)\r\n\t\tCamera:CameraMove(Vector2(0,deltapos.y))\r\n\tend\r\nend\r\n\r\nfunction cameraZoom(pos1,pos2,dis,speed)\r\n\tif world.CurrentCamera.CameraMode==1 then\r\n\t\tworld.CurrentCamera.Distance=world.CurrentCamera.Distance-dis/50\r\n\tend\r\nend\r\n\r\nfunction countTouch(container)\r\n\tTouchNumber=#container\r\nend\r\n\r\nscript.Parent.OnPanStay:Connect(cameraMove)\r\nscript.Parent.OnPinchStay:Connect(cameraZoom)\r\nscript.Parent.OnTouched:Connect(countTouch)\r\n"}}]},{"class":"cUiButtonObject","name":"JumpButton","guid":[102160580,854410432,2549292484,1202403965],"parentGuid":[2288685280,129189584,3004433564,697975946],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"JumpButton"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":26,"class":"sUiButtonComponent","data":{"m_addedSize":[200.0,200.0],"m_widgetSize":[203.71746826171876,203.71746826171876],"m_order":1,"m_pivot":[0.0,0.0],"m_anchorsX":[0.8500000238418579,0.8500000238418579],"m_anchorsY":[0.10000000149011612,0.10000000149011612],"m_anchor":"kAlignBottomLeft","m_anchorPercent":[0.0,0.0],"m_alignment":"kAlignBottomRight","m_alignmentPercent":[1.0,0.0],"m_preSize":[203.71746826171876,203.71746826171876],"m_acceptRaycastWhenEdit":true,"m_prePivot":[0.0,0.0],"m_preAnchorsX":[0.8500000238418579,0.8500000238418579],"m_preAnchorsY":[0.10000000149011612,0.10000000149011612],"m_finalSize":[200.0,200.0],"m_autoScale":true,"m_autoScaleType":"ByParentDiagonal","m_image":{"m_guid":[1381378012,3623568531,2182762728,2959803675],"m_revision":0,"m_type":"kTexture","m_autoGenerated":false},"m_imageColor":[1.0196077823638917,1.0196077823638917,1.0196077823638917,1.0],"m_text":"button","m_averageColor":[0.20000000298023225,0.20000000298023225,0.20000000298023225,0.5960784554481506],"m_averageColorReciprocal":[5.0,5.0,5.0,1.6776314973831177],"m_hoverImage":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_pressedImage":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_disabledImage":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false}}}]},{"class":"cScriptObject","name":"Script","guid":[1268784625,3114224356,2978109736,848837611],"parentGuid":[102160580,854410432,2549292484,1202403965],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Script"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"-- script\r\nfunction Jump()\r\n\tif localPlayer.IsOnGround and localPlayer.State~=Enum.CharacterState.Died then\r\n\t\tlocalPlayer:Jump()\r\n\tend\r\nend\r\n\r\nscript.Parent.OnClick:Connect(Jump)"}}]},{"class":"cUiJoystickObject","name":"Joystick","guid":[214363713,4292497295,3028021729,2005335375],"parentGuid":[2288685280,129189584,3004433564,697975946],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Joystick"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":30,"class":"sUiJoystickComponent","data":{"m_widgetSize":[305.5762023925781,305.5762023925781],"m_order":2,"m_pivot":[0.0,0.0],"m_anchorsX":[0.10000000149011612,0.10000000149011612],"m_anchorsY":[0.10000000149011612,0.10000000149011612],"m_anchor":"kAlignTopLeft","m_anchorPercent":[0.0,0.0],"m_alignment":"kAlignBottomLeft","m_alignmentPercent":[0.0,0.0],"m_preSize":[305.5762023925781,305.5762023925781],"m_prePivot":[0.0,0.0],"m_preAnchorsX":[0.10000000149011612,0.10000000149011612],"m_preAnchorsY":[0.10000000149011612,0.10000000149011612],"m_finalSize":[300.0,300.0],"m_autoScale":true,"m_autoScaleType":"ByParentDiagonal","m_threshold":0.10000000149011612,"m_workArea":[230.61419677734376,230.61419677734376],"m_backGround":{"m_guid":[1676341669,384255279,2994375601,539764901],"m_revision":0,"m_type":"kTexture","m_autoGenerated":false},"m_handle":{"m_guid":[1309922238,2547074866,2257169120,2540834883],"m_revision":0,"m_type":"kTexture","m_autoGenerated":false},"m_arrow":{"m_guid":[3072216954,3382394894,3198588415,2980353886],"m_revision":0,"m_type":"kTexture","m_autoGenerated":false},"m_normalized":true}}]},{"class":"cConstraintFreeObject","name":"ConstraintFree","guid":[2664149892,2599504529,2239431142,2444569089],"parentGuid":[417325223,2932100337,2430726746,1418825083],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ConstraintFree"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sConstraintFreeComponent","data":{}}]},{"class":"cPrimitiveObject","name":"Cube","guid":[3975424097,1952858743,3124273456,2934115946],"parentGuid":[2664149892,2599504529,2239431142,2444569089],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Cube"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sBasicShapeComponent","data":{"m_size":[0.10000000149011612,0.10000000149011612,0.10000000149011612]}},{"id":12,"class":"sRigidBodyComponent","data":{"m_density":900.0,"m_frictionRate":0.4000000059604645,"m_rough":0.3499999940395355,"m_restitution":0.699999988079071,"m_responseContact":false}},{"id":13,"class":"sMaterialComponent","data":{"m_color":[0.9607843160629273,0.9607843160629273,0.9607843160629273,0.0]}},{"id":30,"class":"sRenderComponent","data":{}},{"id":3,"class":"sSizeComponent","data":{}},{"id":666,"class":"sStateSyncComponent","data":{"m_syncRotation":[0.0,0.0,0.0,1.0],"m_distrSimVersion":0}}]},{"class":"cCamera","name":"GameCamera","guid":[759347957,2245412439,2215380327,3955432270],"parentGuid":[3975424097,1952858743,3124273456,2934115946],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"GameCamera"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sCameraComponent","data":{"m_viewPortHeight":629,"m_viewPortWidth":1229,"m_nearClip":0.029999999329447748}},{"id":11,"class":"sRenderComponent","data":{}},{"id":20,"class":"sCameraBehaviorComponent","data":{"m_cameraMaxZoomDistance":50.0}},{"id":30,"class":"sAudioListenerComponent","data":{}}]},{"class":"cFolderObject","name":"C_Code","guid":[1988763669,642008485,3045610516,4157666106],"parentGuid":[417325223,2932100337,2430726746,1418825083],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"C_Code"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cScriptObject","name":"PlayerControlScript","guid":[1560065165,549536527,2196214773,3289613067],"parentGuid":[1988763669,642008485,3045610516,4157666106],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"PlayerControlScript"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"local Player = localPlayer.Player\r\nlocal Client = localPlayer\r\nlocal GUI = Client.Local.ScreenGUI\r\nlocal Joystick = GUI.Joystick\r\nworld.CurrentCamera=Client.Local.ConstraintFree.Cube.GameCamera\r\nlocal Camera=world.CurrentCamera\r\nlocal Mode = Camera.CameraMode\r\nCamera.LookAt = Player\r\n\r\nlocal ForwardKey = Enum.KeyCode.W\r\nlocal BackKey = Enum.KeyCode.S\r\nlocal LeftKey = Enum.KeyCode.A\r\nlocal RightKey = Enum.KeyCode.D\r\nlocal JumpKey = Enum.KeyCode.Space\r\n\r\nlocal MoveForward = 0\r\nlocal MoveBack = 0\r\nlocal MoveLeft = 0\r\nlocal MoveRight = 0\r\n\r\n--获取按键盘时的移动方向最终取值\r\nfunction GetMovement()\r\n\tMoveForward = Input.GetPressKeyData(ForwardKey)>0 and 1 or 0\r\n\tMoveBack = Input.GetPressKeyData(BackKey)>0 and -1 or 0\r\n\tMoveLeft = Input.GetPressKeyData(LeftKey)>0 and 1 or 0\r\n\tMoveRight = Input.GetPressKeyData(RightKey)>0 and -1 or 0\r\n\tif Player.State==Enum.CharacterState.Died then\r\n\t\tMoveForward=0\r\n\t\tMoveBack=0\r\n\t\tMoveLeft=0\r\n\t\tMoveRight=0\r\n\tend\r\nend\r\n\r\n--移动逻辑\r\nfunction Move(Dir)\r\n\tDir.y = 0\r\n\tif Player.State==Enum.CharacterState.Died then\r\n\t\tDir=Vector2.Zero\r\n\tend\r\n\tif Dir.Magnitude>0 then\r\n\t\tif Mode==1 and Camera.Distance>=0 or Mode==4 then\r\n\t\t\tPlayer:FaceToDir(Dir, 4*math.pi)\r\n\t\tend\r\n\t\tPlayer:MoveTowards(Vector2(Dir.x,Dir.z).Normalized)\r\n\telse\r\n\t\tPlayer:MoveTowards(Vector2.Zero)\r\n\tend\r\nend\r\n\r\n--玩家死亡时的逻辑\r\nfunction PlayerDie()\r\n\tPlayer:MoveTowards(Vector2(0, 0))\r\n\tPlayer:Die()\r\n\tlocal RespawnTime=Player.RespawnTime\r\n\twait(RespawnTime)\r\n\tPlayer:Reset()\r\nend\r\nPlayer.OnDead:Connect(PlayerDie)\r\n\r\n--每个渲染帧处理操控逻辑\r\nfunction MainControl()\r\n\tif Player.Health<=0 then\t\r\n\t\tPlayer:Die()\r\n\t\treturn\r\n\tend\r\n\tif Input.GetPressKeyData(JumpKey)>0 then\r\n\t\tif Player.IsOnGround and Player.State~=Enum.CharacterState.Died then\r\n\t\t\tPlayer:Jump()\r\n\t\t\treturn\r\n\t\tend\r\n\tend\r\n\tCamera=world.CurrentCamera\r\n\tMode = Camera.CameraMode\r\n\tlocal Forward = (Mode==1 and Camera.Distance>=0 or Mode==4) and Camera.Forward or Player.Forward \r\n\tForward.y=0\r\n\tlocal Right = Vector3(0,1,0):Cross(Forward)\r\n\tlocal Horizontal = Joystick.Horizontal\r\n\tlocal Vertical = Joystick.Vertical\r\n\tlocal Dir = Vector3.Zero\r\n\tif Horizontal~=0 or Vertical~=0 then\r\n\t\tDir = Right*Horizontal+Forward*Vertical\r\n\telse\r\n\t\tGetMovement()\r\n\t\tDir = Forward*(MoveForward+MoveBack)-Right*(MoveLeft+MoveRight)\r\n\tend\r\n\tMove(Dir)\r\n\t\r\nend\r\nworld.OnRenderStepped:Connect(MainControl)\r\n\r\n"}}]},{"class":"cScriptObject","name":"PlayerMain","guid":[1590936490,2974695715,2831162716,2733380204],"parentGuid":[1988763669,642008485,3045610516,4157666106],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"PlayerMain"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 客户端代码入口\r\n-- @script Client Main Function\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author XXX, XXX\r\n\r\nPlayerMgr:Init()\r\n"}}]},{"class":"cNodeObject","name":"localPlayer","guid":[2229867806,259017539,2476631306,1972820229],"parentGuid":[2301495294,1274365006,3003438828,1864040556],"components":[{"id":0,"class":"sFullTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"localPlayer"}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":3,"class":"sNetworkComponent","data":{}}]},{"class":"cPlayerInstance","name":"Player","guid":[3921698427,2579318821,3172122006,1001323442],"parentGuid":[2229867806,259017539,2476631306,1972820229],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Player"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sRigidBodyComponent","data":{"m_isStatic":false,"m_density":1000.0,"m_frictionRate":0.0,"m_rough":0.0,"m_restitution":0.0,"m_freezeRotation":true}},{"id":20,"class":"sCharacterControllerComponent","data":{"m_NPCController":true}},{"id":40,"class":"sCharacterStateComponent","data":{"m_displayName":true,"m_isNpc":true}},{"id":50,"class":"sRenderComponent","data":{}},{"id":60,"class":"sNetworkComponent","data":{}},{"id":666,"class":"sStateSyncComponent","data":{"m_syncRotation":[0.0,0.0,0.0,1.0],"m_distrSimVersion":0}}]},{"class":"cPlayerAvatarInstance","name":"Avatar","guid":[2086577372,1035157785,2412732698,2224839101],"parentGuid":[3921698427,2579318821,3172122006,1001323442],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Avatar"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sPlayerModelInstanceComponent","data":{"m_head":{"attriValue":"DefaultMale","valueList":["DefaultMale","Male_Head2","Male_Head3"]},"m_clothes":{"attriValue":"DefaultMale","valueList":["DefaultMale","Male_Chest_TshirtShort_A001","Male_Chest_TshirtShort_A002","Male_Chest_TshirtShort_A003","Male_Chest_TshirtShort_A004","Male_Chest_TshirtShort_A005","Male_Chest_TshirtShort_A006","Male_Chest_TshirtShort_A007","Male_Chest_TshirtShort_A008","Male_Chest_TshirtShort_A009","Male_Chest_TshirtShort_A010","Male_Chest_SweaterLong_A001","Male_Chest_SweaterLong_A002","Male_Chest_SweaterLong_A003","Male_Chest_SweaterLong_A004","Male_Chest_SweaterLong_A005","Male_Chest_SweaterLong_A006","Male_Chest_SweaterLong_A007","Male_Chest_SweaterLong_A008","Male_Chest_SweaterLong_A009","Male_Chest_SweaterLong_A010","Male_Chest_SweaterLong_A011","Male_Chest_SweaterLong_A012","Male_001Jacket","Male_Jacket_Leis01","RedJacket","Male_Jacket_Leis02","Male_Jacket_Leis03","Male_006Jacket","Male_007Jacket","Male_008Tshirt","Male_009Jacket","Male_010Tshirt","Male_011Tshirt","Male_012Jacket","Male_Chest_Robe_India_001","Male_Chest_JacketIndiaSilk_001","Male_AviatorJacket","Male_MexicJacket","Male_SpaceJacket","Male_BaseballJacket","Male_UniverJacket","Male_UniverJacket_01","Male_OwlJacket","Male_Chest_ArmorGriffin_001","Unisex_Chest_ArmorIron_001","Male_WendigoJacket","Male_NutJacket","Male_Chest_UniformPolice_001","Male_Chest_TshitSki_001","Male_Chest_JacketRobtDog_001","Male_Chest_MuscleSuitShark_001","Male_Chest_MuscleSuitShark_002","Male_Chest_TshirtWaste_001","Male_Chest_JacketBiker_001","Male_Chest_TshirtSteam_001","Male_Chest_JacketRobtEva_001","Male_Chest_JacketRobtEva_002","Male_Chest_JacketAI_001","Male_Chest_TshirtCowboy_001","Male_Zombies01Tshirt","Male_Zombies03Jacket","Male_Zombies04Tshirt","Male_Zombies06Jacket"]},"m_trousers":{"attriValue":"DefaultMale","valueList":["DefaultMale","Male_Jeans01Trousers","Male_Leis01Trousers","Male_003Trousers","Male_Leis01Pants","Male_Leis03Trousers","Male_006Trousers","Male_007Trousers","Male_008Trousers","Male_009Trousers","Male_010Trousers","Male_011Trousers","Male_012Pants","Male_Leg_Pants_India_001","Male_Leg_TrousersIndiaSilk_001","Male_AviatorTrousers","Male_MexicTrousers","Male_SpaceTrousers","Male_BaseballTrousers","Male_UniverTrousers","Male_UniverTrousers_01","Male_OwlTrousers","Male_Leg_ArmorGriffin_001","Male_Leg_ArmorIron_001","Male_WendigoTrousers","Male_NutTrousers","Male_Leg_PantsLPolice_001","Male_Leg_PantsLSki_001","Male_Leg_PantsLRobtDog_001","Male_Leg_PantsShark_001","Male_Leg_PantsShark_002","Male_Leg_TrousersWaste_001","Male_Leg_TrousersBiker_001","Male_Leg_TrousersSteam_001","Male_Leg_PantsLRobtEva_001","Male_Leg_PantsLRobtEva_002","Male_Leg_PantsLAI_001","Male_Leg_TrousersCowboy_001","Male_Zombies01Pants","Male_Zombies03Trousers","Male_Zombies04Trousers","Male_Zombies06Trousers"]},"m_hair":{"attriValue":"DefaultMale","valueList":["DefaultMale","Hair_Brown01M","Hair_Blonde01M","Hair_Blonde02M","Hair_Orange01M","Hair_White01M","Hair_Green01M","Male_Head_Hair_015","Male_Head_Hair_014","Male_Head_Hair_028","Hair_Zombies06_M"]},"m_hands":{"attriValue":"DefaultMale","valueList":["DefaultMale","Male_GLeather01","Male_AviatorGloves","Male_SpaceGloves","Male_BaseballGloves","Male_UniverGloves","Male_UniverGloves_01","Male_OwlGloves","Unisex_Hand_GlovesGriffin_001","Unisex_Hand_GlovesIron_001","Male_WendigoGloves","Unisex_Hand_GlovesSki_001","Unisex_Hand_GlovesRobtDog_001","Male_Hand_GlovesBiker_001","Unisex_Hand_GlovesRobtEva_001","Unisex_Hand_GlovesRobtEva_002","Unisex_Hand_GlovesAI_001","Male_Hand_GlovesSteam_001"]},"m_shoes":{"attriValue":"DefaultMale","valueList":["DefaultMale","LeatherShoe","Male_Leis01Shoes","Unisex_Feet_CanvasShoes_A001","Unisex_Feet_CanvasShoes_A002","Unisex_Feet_CanvasShoes_A003","Unisex_Feet_CanvasShoes_A004","Unisex_Feet_CanvasShoes_A005","Unisex_Feet_CanvasShoes_A006","Unisex_Feet_CanvasShoes_A007","Unisex_Feet_CanvasShoes_A008","Unisex_Feet_CanvasShoes_A009","Unisex_Feet_CanvasShoes_A010","Male_003Shoes","Male_BLeather01","Male_Leis03Shoes","Male_006Shoes","Male_007Shoes","Male_008Shoes","Male_009Shoes","Unisex_Feet_BasketballShoes_003","Male_010Shoes","Male_011Boots","Male_012Boots","Male_Feet_Shoes_India_001","Male_Feet_ShoesIndiaSilk_001","Male_AviatorShoes","Male_MexicBoots","Male_SpaceBoots","Male_BaseballShoes","Male_UniverShoes","Male_UniverShoes_01","Male_OwlBoots","Unisex_Feet_ShoesGriffin_001","Unisex_Feet_ShoesIron_001","Male_WendigoShoes","Male_NutBoots","Unisex_Feet_ShoesPolice_001","Unisex_Feet_BootsSki_001","Unisex_Feet_ShoesSki_001","Male_Feet_ShoesRobtDog_001","Unisex_Feet_SlippersShark_001","Male_Feet_BootsWaste_001","Male_Feet_BootsBiker_001","Male_Feet_BootsSteam_001","Unisex_Feet_ShoesRobtEva_001","Unisex_Feet_ShoesRobtEva_002","Unisex_Feet_ShoesAI_001","Male_Feet_BootsCowboy_001","Male_Zombies01Shoes","Male_Zombies03Boots","Male_Zombies04Boots","Male_Zombies06Shoes"]},"m_face":{"attriValue":"DefaultMale","valueList":["DefaultMale","Male_test1","Male_test2","Male_test3","Male_test5","Male_test6","Male_test7","Male_test8","Male_test9","Male_test10","Male_test11","Male_test12","Zombies_test1","Zombies_test2","Zombies_test3","Zombies_test4","Zombies_test5","Zombies_test6"]},"m_skinColor":{"attriValue":"DefaultMale","valueList":["DefaultMale","Color2","Color3","Color4","Color5","Color6","Color7","Color8","Color9","Color10","Color11","Color12","Color13"]},"m_headAccessory":{"attriValue":"Empty_Head","valueList":["Empty_Head","Male_ComHat_001","Male_ComHat003","Male_ComHat004","Male_ComHat005","Male_ComHat006","Male_ComHat007","Male_008Hat","Male_010Hat","Male_011Hat","Male_012Hat","Male_Head_ComHelmet_002","Male_ComHelmet003","Male_ComHelmet004","Male_ComHelmet005","Male_013Hat","Male_AviatorHat","Male_MexicHat","Male_SpaceHelmet","Male_Baseball01Hat","Male_Baseball02Hat","Male_UniverHelmet","Male_UniverHelmet_01","Male_Owl_Helmet","Male_Head_HelmetGriffin_001","Unisex_Head_HelmetIron_001","Male_Wendigo_Helmet","Male_Nut_Helmet","Unisex_Head_MaskPolice_001","Unisex_Head_CapPolice_001","Unisex_Head_CapSki_001","Male_Head_HelmetRobtDog_001","Male_Head_HelmetShark_001","Male_Head_HelmetBiker_001","Male_Head_HatSteam_001","Unisex_Head_HelmetRobtEva_001","Unisex_Head_HelmetRobtEva_002","Unisex_Head_HelmetAI_001","Male_Head_Hat_India_001","Male_Head_HelmetIndiaSilk_001","Male_Head_HelmetIndiaSilk_002","Male_Head_HatCowboy_001","Unisex_Head_JewelsMadMax_001","Male_Zombies01Hat","Male_Zombies03_Helmet","Male_Zombies04_Helmet","Male_Zombies06_Hat"]},"m_neckAccessory":{"attriValue":"Empty_Neck","valueList":["Empty_Neck","Male_AviatorScarf","Male_AviatorScarf_02","Male_AviatorScarf_03","Male_Zombies06_ChestSup","Unisex_Chest_LifeVest_01"]},"m_shouldersAccessory":{"attriValue":"Empty_Shoulders","valueList":["Empty_Shoulders"]},"m_legsAccessory":{"attriValue":"Empty_Legs","valueList":["Empty_Legs","Male_AviatorKneepad","Male_OwlKneepad","Unisex_Knee_PadGriffin_001","Unisex_Knee_PadIron_001","Unisex_Knee_PadPolice_001","Unisex_Knee_PadWaste_001","Unisex_Knee_PadBiker_001"]},"m_handsAccessory":{"attriValue":"Empty_Hands","valueList":["Empty_Hands","Watch","Male_010Wrist","Male_011Wrist","Male_SteamWrist","Male_IndiaSilkWrist"]},"m_bodyAccessory":{"attriValue":"Empty_Body","valueList":["Empty_Body","Male_009Bag","Male_012Bag","Female_Chest_Hobo_002","Male_AviatorBag","Male_MexicUkulele","Male_SpaceBag","Male_BaseballBag","Male_UniverBag","Male_WendigoBag","Unisex_Back_BackpackPolice_001","Unisex_Back_BackpackSki_001","Female_Back_BackpackSteam_001","Male_Zombies04Bag","Female_Zombies05Bag","Male_Zombies06Bag"]},"m_waistAccessory":{"attriValue":"","valueList":["Empty_Waist","LifeBuoy","Unisex_Pelvis_Lifebuoy_Duck_01","Unisex_Pelvis_Lifebuoy_Donut_01","Unisex_Pelvis_Lifebuoy_Donut_02","Unisex_Pelvis_Lifebuoy_Watermelon","Unisex_Pelvis_Lifebuoy_Tire","NutSabre","Male_Pelvis_Cowboy_GunBag"]},"m_specialAccessory":{"attriValue":"Empty_Special","valueList":["Empty_Special"]},"m_faceAccessory":{"attriValue":"","valueList":["Empty_Face","Glasses","Female_MadMax_Glasses","HeadSet"]},"m_wristAccessory":{"attriValue":"","valueList":["Empty_Wrist"]},"m_shoulderArmorAccessory":{"attriValue":"","valueList":["Empty_ShoulderArmor","Male_OwlShoulder","Male_Shoulder_ArmorGriffin_001","Unisex_Shoulder_ArmorIron_001","Male_WendigoShoulder","Unisex_Shoulder_ArmorWaste_001","Female_SteamShoulder","Male_RobtEvaShoulder","Male_RobtEvaShoulder_02","Male_AIShoulder"]},"m_chestArmorAccessory":{"attriValue":"","valueList":["Empty_ChestArmor","Male_BchestSup","Male_ComChestSup001","Male_ComChestSup002","Male_ComChestSup003"]},"m_upperArmGuardAccessory":{"attriValue":"","valueList":["Empty_UpperArmGuard","Male_BaseballGuard","Unisex_Elbow_PadsIron_001"]},"m_currentDress":"{\"boneSizeList\":[1.0,1.0,1.0],\"curDressList\":[\"DefaultMale\",\"DefaultMale\",\"DefaultMale\",\"DefaultMale\",\"DefaultMale\",\"DefaultMale\",\"DefaultMale\",\"DefaultMale\",\"Empty_Head\",\"Empty_Neck\",\"Empty_Shoulders\",\"Empty_Body\",\"Empty_Hands\",\"\",\"Empty_Legs\",\"Empty_Special\",\"\",\"\"],\"gender\":1,\"name\":\"CurrentDress\",\"ornamentsKeys\":[],\"ornamentsValues\":[],\"skinColor\":{\"a\":1.0,\"b\":0.5372549295425415,\"g\":0.6666666865348816,\"r\":0.9137254953384399}}"}},{"id":20,"class":"sAnimationComponent","data":{}},{"id":40,"class":"sRenderComponent","data":{}}]},{"class":"cBoneAnchor","name":"Bone_Head","guid":[1952377286,2257011431,2235437585,1990350708],"parentGuid":[2086577372,1035157785,2412732698,2224839101],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[-0.0000016757369394326816,1.3431568145751954,-0.04980217665433884],"m_localRotation":[0.5163317322731018,-0.4831157326698303,-0.516330897808075,0.4831181466579437]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Bone_Head"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sBoneAnchorComponent","data":{"m_boneName":"Bone_Head"}}]},{"class":"cBoneAnchor","name":"Bone_R_Hand","guid":[1365265308,2584495651,3179854900,2314059387],"parentGuid":[2086577372,1035157785,2412732698,2224839101],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[0.4200737476348877,0.817010223865509,-0.03068430721759796],"m_localRotation":[-0.1410028040409088,0.020078253000974656,0.8559507131576538,0.4970548450946808]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Bone_R_Hand"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sBoneAnchorComponent","data":{"m_boneName":"Bone_R_Hand"}}]},{"class":"cBoneAnchor","name":"Bone_L_Hand","guid":[1001141281,105596195,2413995681,1572381856],"parentGuid":[2086577372,1035157785,2412732698,2224839101],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[-0.4200739860534668,0.8170075416564941,-0.03068537637591362],"m_localRotation":[0.855949342250824,0.49705755710601809,-0.14100155234336854,0.020079465582966806]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Bone_L_Hand"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sBoneAnchorComponent","data":{"m_boneName":"Bone_L_Hand"}}]},{"class":"cBoneAnchor","name":"Bone_Pelvis","guid":[3930266631,3765193548,2657671196,2444667291],"parentGuid":[2086577372,1035157785,2412732698,2224839101],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[-0.0,0.7860299348831177,-0.06749999523162842],"m_localRotation":[0.500001072883606,-0.5000002980232239,-0.49999892711639407,0.4999997019767761]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Bone_Pelvis"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sBoneAnchorComponent","data":{"m_boneName":"Bone_Pelvis"}}]},{"class":"cBoneAnchor","name":"Bone_R_Foot","guid":[1011560467,1551582414,3132691223,44035332],"parentGuid":[2086577372,1035157785,2412732698,2224839101],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[0.15842828154563905,0.11951876431703568,-0.10738064348697663],"m_localRotation":[0.548750102519989,0.5487515926361084,0.445951908826828,0.44595056772232058]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Bone_R_Foot"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sBoneAnchorComponent","data":{"m_boneName":"Bone_R_Foot"}}]},{"class":"cBoneAnchor","name":"Bone_L_Foot","guid":[3538847244,808075570,2480843790,1198870357],"parentGuid":[2086577372,1035157785,2412732698,2224839101],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[-0.15842397511005402,0.11951779574155808,-0.10738103091716767],"m_localRotation":[0.4459499716758728,0.4459512233734131,0.5487523078918457,0.5487504601478577]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Bone_L_Foot"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sBoneAnchorComponent","data":{"m_boneName":"Bone_L_Foot"}}]},{"class":"cUiSurfaceUiObject","name":"NameGUI","guid":[1405111285,2384023431,3182972373,2500518680],"parentGuid":[3921698427,2579318821,3172122006,1001323442],"components":[{"id":0,"class":"sFullTransform","data":{"m_localPosition":[0.0,2.0,0.0]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"NameGUI"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":26,"class":"sUiSurfaceUiComponent","data":{"m_pivot":[0.0,0.0],"m_anchorsX":[0.0,0.0],"m_anchorsY":[0.0,0.0],"m_anchor":"kAlignBottomLeft","m_anchorPercent":[0.0,0.0],"m_alignment":"kAlignBottomLeft","m_alignmentPercent":[0.0,0.0],"m_preSize":[300.0,80.0],"m_billboard":true,"m_size":[300.0,80.0],"m_disappearDistance":50000,"m_originSize":[300.0,80.0]}}]},{"class":"cUiTextObject","name":"NameBar","guid":[3515521018,3624552389,2321875400,3242185261],"parentGuid":[1405111285,2384023431,3182972373,2500518680],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"NameBar"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":23,"class":"sUiTextComponent","data":{"m_addedSize":[300.0,80.0],"m_widgetSize":[562.5,80.0],"m_order":1,"m_anchor":"kAlignBottomLeft","m_preSize":[562.5,80.0],"m_oldTreeLevelVersion":true,"m_finalSize":[300.0,80.0],"m_offset":[0.0,10.0],"m_preOffset":[0.0,10.0],"m_autoScale":true,"m_autoScaleType":"ByParentScale","m_text":"","m_textColor":[0.9764705896377564,0.9764705896377564,0.9764705896377564,1.0],"m_fontSize":20,"m_wrap":true}}]},{"class":"cScriptObject","name":"Script","guid":[3648344019,2319469073,2373482710,1056499623],"parentGuid":[1405111285,2384023431,3182972373,2500518680],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Script"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"Namebar=script.Parent.NameBar\r\nNameGUI=script.Parent\r\nHealthGUI=script.Parent.Parent.HealthGUI.Health\r\nplayer=script.Parent.Parent\r\nwhile true do\r\n        Namebar:SetActive(player.DisplayName)\r\n        Namebar.Text=player.Name\r\n        \r\n        if HealthGUI==nil or  HealthGUI.ActiveSelf==false then\r\n                NameGUI.Position=player.Position+Vector3(0,1+player.Avatar.Height,0)\r\n        else\r\n                NameGUI.Position=player.Position+Vector3(0,1.1+player.Avatar.Height,0)\r\n        end\r\n        if Namebar:GetClosestTeam()~=world.Players and Namebar:GetClosestTeam()~=nil then\r\n                Namebar.Color=Namebar:GetClosestTeam().TeamColor\r\n        end\r\n        wait()\r\nend"}}]},{"class":"cUiSurfaceUiObject","name":"HealthGUI","guid":[1362459126,1156792341,2681269783,824873225],"parentGuid":[3921698427,2579318821,3172122006,1001323442],"components":[{"id":0,"class":"sFullTransform","data":{"m_localPosition":[0.0,2.0,0.0]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"HealthGUI"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":26,"class":"sUiSurfaceUiComponent","data":{"m_pivot":[0.0,0.0],"m_anchorsX":[0.0,0.0],"m_anchorsY":[0.0,0.0],"m_anchor":"kAlignBottomLeft","m_anchorPercent":[0.0,0.0],"m_alignment":"kAlignBottomLeft","m_alignmentPercent":[0.0,0.0],"m_preSize":[160.0,80.0],"m_billboard":true,"m_size":[160.0,80.0],"m_disappearDistance":50000,"m_originSize":[160.0,80.0]}}]},{"class":"cUiImageObject","name":"BackGround","guid":[2692120497,1768836605,2660612515,4269796384],"parentGuid":[1362459126,1156792341,2681269783,824873225],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"BackGround"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":22,"class":"sUiImageComponent","data":{"m_addedSize":[160.0,31.0],"m_widgetSize":[160.0,31.0],"m_order":1,"m_pivot":[0.0,0.0],"m_anchorsX":[0.0,0.0],"m_anchorsY":[0.0,0.0],"m_anchor":"kAlignBottomLeft","m_anchorPercent":[0.0,0.0],"m_alignment":"kAlignBottomLeft","m_alignmentPercent":[0.0,0.0],"m_preSize":[160.0,31.0],"m_acceptRaycastWhenEdit":true,"m_prePivot":[0.0,0.0],"m_preAnchorsX":[0.0,0.0],"m_preAnchorsY":[0.0,0.0],"m_finalSize":[160.0,31.0],"m_offset":[-0.00000667572021484375,6.0],"m_preOffset":[-0.00000667572021484375,6.0],"m_imagePriSize":[136.0,28.0],"m_textureRef":{"m_guid":[2748549193,222842754,2941154731,726271496],"m_revision":0,"m_type":"kTexture","m_autoGenerated":false},"m_imageColor":[1.0,1.0,1.0,0.9555555582046509],"m_averageColor":[1.0,1.0,1.0,0.1764705926179886],"m_averageColorReciprocal":[1.0,1.0,1.0,5.666666507720947]}}]},{"class":"cUiImageObject","name":"Health","guid":[3177680961,308758981,2341371969,3691269346],"parentGuid":[1362459126,1156792341,2681269783,824873225],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Health"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":20,"class":"sRenderComponent","data":{}},{"id":22,"class":"sUiImageComponent","data":{"m_addedSize":[143.0,15.0],"m_widgetSize":[143.0,15.0],"m_order":1,"m_pivot":[0.0,0.0],"m_anchorsX":[0.0,0.0],"m_anchorsY":[0.0,0.0],"m_anchor":"kAlignBottomLeft","m_anchorPercent":[0.0,0.0],"m_alignment":"kAlignBottomLeft","m_alignmentPercent":[0.0,0.0],"m_preSize":[143.0,15.0],"m_acceptRaycastWhenEdit":true,"m_prePivot":[0.0,0.0],"m_preAnchorsX":[0.0,0.0],"m_preAnchorsY":[0.0,0.0],"m_finalSize":[143.0,15.0],"m_offset":[8.5,14.0],"m_preOffset":[8.5,14.0],"m_imagePriSize":[124.0,16.0],"m_textureRef":{"m_guid":[364921788,1323712570,2497125887,1146669227],"m_revision":0,"m_type":"kTexture","m_autoGenerated":false},"m_imageColor":[4.5625,1.0,3.161290407180786,1.0],"m_averageColor":[0.062745101749897,1.0,0.12156862765550614,1.0],"m_averageColorReciprocal":[15.937499046325684,1.0,8.22580623626709,1.0]}}]},{"class":"cScriptObject","name":"Script","guid":[4158487454,792609324,3178147409,2519421303],"parentGuid":[1362459126,1156792341,2681269783,824873225],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Script"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"-- script\r\nHealthBar=script.Parent.Health\r\nHealthBackground=script.Parent.BackGround\r\nOriginSize=HealthBar.Size\r\nHealthRed=ResourceManager.GetTexture(\"Blood_Red\")\r\nHealthGreen=ResourceManager.GetTexture(\"Blood_Green\")\r\nHealthOrange=ResourceManager.GetTexture(\"Blood_Orange\")\r\nHealthChangeTime=0\r\nTimerNow=0\r\nplayer=script.Parent.Parent\r\nfunction healthChange()\r\n\tHealthChangeTime=Timer.GetTime()\r\n\tProperty=player.Health/player.MaxHealth\r\n\tif Property>=0.7 then\r\n\t\tHealthBar.Texture=HealthGreen\r\n\telseif Property>=0.3 then\r\n\t\tHealthBar.Texture=HealthOrange\r\n\telse\r\n\t\tHealthBar.Texture=HealthRed\r\n\tend\t\r\n\tHealthBar.Size=Vector2(OriginSize.x * Property,OriginSize.y)\r\nend\r\n\r\nplayer.OnHealthChange:Connect(healthChange)\r\n\r\nwhile true do\r\n\tTimerNow=Timer.GetTime()\r\n\tif player.HealthDisplayMode==Enum.HealthDisplayMode.Always then\r\n\t\tHealthBar:SetActive(true)\r\n\t\tHealthBackground:SetActive(true)\r\n\telseif player.HealthDisplayMode==Enum.HealthDisplayMode.Never then\r\n\t\tHealthBar:SetActive(false)\r\n\t\tHealthBackground:SetActive(false)\r\n\telseif player.HealthDisplayMode==Enum.HealthDisplayMode.OnHit then\r\n\t\tif player.Health~=player.MaxHealth then\r\n\t\tHealthBar:SetActive(true)\r\n\t\tHealthBackground:SetActive(true)\r\n\t\telse\r\n\t\tHealthBar:SetActive(false)\r\n\t\tHealthBackground:SetActive(true)\r\n\t\tend\r\n\telse \r\n\t\tif TimerNow<=HealthChangeTime+2 and HealthChangeTime ~=0 then\r\n\t\tHealthBar:SetActive(true)\r\n\t\tHealthBackground:SetActive(true)\r\n\t\telse\r\n\t\tHealthBar:SetActive(false)\r\n\t\tHealthBackground:SetActive(false)\r\n\t\tend\r\n\tend\r\n\twait(0.01)\t\r\nend"}}]},{"class":"cFolderObject","name":"C_Event","guid":[2292071358,1506495263,2198482554,1903889976],"parentGuid":[2229867806,259017539,2476631306,1972820229],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"C_Event"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cCustomEventObject","name":"ClientExample01Event","guid":[2692906001,400442409,2471841936,3656382497],"parentGuid":[2292071358,1506495263,2198482554,1903889976],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ClientExample01Event"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":511,"class":"sCustomEventComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--自定义事件脚本, 会监听由FireEventTo系列触发的与该脚本名一样的事件\r\n--参数(arg1, arg2, arg3 ...) : 为各个事件参数\r\n","m_scriptType":"kCustomFunction"}}]},{"class":"cCustomEventObject","name":"ClientExample02Event","guid":[4280271411,1924088491,2838919974,2621789847],"parentGuid":[2292071358,1506495263,2198482554,1903889976],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ClientExample02Event"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":511,"class":"sCustomEventComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--自定义事件脚本, 会监听由FireEventTo系列触发的与该脚本名一样的事件\r\n--参数(arg1, arg2, arg3 ...) : 为各个事件参数\r\n","m_scriptType":"kCustomFunction"}}]},{"class":"cCustomEventObject","name":"ClientExample03Event","guid":[1505293026,2520205713,2880716936,3351337845],"parentGuid":[2292071358,1506495263,2198482554,1903889976],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ClientExample03Event"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":511,"class":"sCustomEventComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--自定义事件脚本, 会监听由FireEventTo系列触发的与该脚本名一样的事件\r\n--参数(arg1, arg2, arg3 ...) : 为各个事件参数\r\n","m_scriptType":"kCustomFunction"}}]}]},{"ObjectsLinker":[{"class":"cWorkspace","name":"World","guid":[1981988479,3555894,2597800867,69741929],"spaceId":"kDefaultSpace","objectType":0},{"class":"cWorkspace","name":"Global","guid":[344576033,1668630255,2683907297,2226597768],"spaceId":"kDefaultSpace","objectType":0},{"class":"cScriptObject","name":"AutoAssignTeamScript","guid":[1988307774,2442019711,2592872571,1277204125],"spaceId":"kDefaultSpace","objectType":0},{"class":"cScriptObject","name":"LuaFunctionScript","guid":[3330332978,589909841,2774054172,1565862559],"spaceId":"kDefaultSpace","objectType":0},{"class":"cScriptObject","name":"ModuleRequireScript","guid":[2221840009,1976321846,2245245619,407532979],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"Utility","guid":[1158799413,2751941742,3186700785,1570109853],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"NetUtilModule","guid":[3138092138,940262650,3093420508,667201143],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"CsvUtilModule","guid":[3433342930,3050064207,3042438006,35244977],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"EventUitlModule","guid":[2990017477,1670333273,2674323178,1532840206],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"Plugin","guid":[3421449223,220021494,2714239174,1946870819],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"FUNC_UIAnimation","guid":[1331349991,2616282402,2630754420,1905460436],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"ReadMe","guid":[2979943216,551765364,2248158137,2732055024],"spaceId":"kDefaultSpace","objectType":0},{"class":"cCustomEventObject","name":"StartAnimationEvent","guid":[422217733,3439480519,2787533495,3744167565],"spaceId":"kDefaultSpace","objectType":0},{"class":"cCustomEventObject","name":"AnimationStateEvent","guid":[2240976140,335758174,2687189224,322413573],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"Code","guid":[2747130650,1726107529,2983478535,4170811724],"spaceId":"kDefaultSpace","objectType":0},{"class":"cScriptObject","name":"AnimationMain","guid":[3270875816,3576709130,2580715786,62020743],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"DataModule","guid":[248227229,1371949624,2628757272,720694732],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"Define","guid":[3643209718,4192551772,2636302611,3473650035],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"GlobalDefModule","guid":[3584163079,3374337710,2390188471,2399437392],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"ConstDefModule","guid":[1768866970,2821735027,2612949907,3460044805],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"Module","guid":[2883110320,3875490972,2778882821,1569891889],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"S_Module","guid":[2325219688,3448000480,2204321929,4246846969],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"GameMgrModule","guid":[112830824,171854255,2946136964,1894336579],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"CsvConfigModule","guid":[112798298,387337249,2420484563,3059665706],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"ExampleAModule","guid":[2387834855,1574587674,2670415526,3557140699],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"C_Module","guid":[2085024476,779046503,2599607412,4053327341],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"PlayerMgrModule","guid":[1039137540,2610905714,3183561849,1647783672],"spaceId":"kDefaultSpace","objectType":0},{"class":"cModuleScriptObject","name":"ExampleBModule","guid":[646356249,1292323580,2768118403,2865367294],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"Csv","guid":[2272249561,3378007281,2688214392,3190071702],"spaceId":"kDefaultSpace","objectType":0},{"class":"cTableObject","name":"UIAnimation","guid":[1097962876,3754445060,2192136032,4179300550],"spaceId":"kDefaultSpace","objectType":0},{"class":"cTableObject","name":"Example01","guid":[1009384381,1318601170,2335100178,2096260731],"spaceId":"kDefaultSpace","objectType":0},{"class":"cTableObject","name":"Example02","guid":[519619536,3748807551,2763899961,330082025],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"S_Event","guid":[3388698598,504056136,2819280548,3600804874],"spaceId":"kDefaultSpace","objectType":0},{"class":"cCustomEventObject","name":"Example01CustomEvent","guid":[1849321353,1174686080,2581212444,423150465],"spaceId":"kDefaultSpace","objectType":0},{"class":"cCustomEventObject","name":"Example02CustomEvent","guid":[2464372298,3888661849,2219280214,4227873962],"spaceId":"kDefaultSpace","objectType":0},{"class":"cCustomEventObject","name":"Example03CustomEvent","guid":[3522954919,4107421185,2760879892,839023523],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"S_Code","guid":[3588299831,2838581107,2638019367,1912244102],"spaceId":"kDefaultSpace","objectType":0},{"class":"cScriptObject","name":"ServerMain","guid":[3478165892,3968682922,3091200964,3154749412],"spaceId":"kDefaultSpace","objectType":0},{"class":"cPrimitiveObject","name":"BaseFloor","guid":[4211227124,399589691,2212667733,3335218667],"spaceId":"kDefaultSpace","objectType":0},{"class":"cFolderObject","name":"SpawnLocations","guid":[1803916521,3674621259,2355104850,441818688],"spaceId":"kDefaultSpace","objectType":0},{"class":"cStartPortal","name":"StartPortal00","guid":[362184257,1300644271,2169624314,2670603163],"spaceId":"kDefaultSpace","objectType":0},{"class":"cStartPortal","name":"StartPortal01","guid":[651144420,800934336,3039799213,1377036607],"spaceId":"kDefaultSpace","objectType":0},{"class":"cStartPortal","name":"StartPortal02","guid":[4009425966,1206468687,2439525561,4287493119],"spaceId":"kDefaultSpace","objectType":0},{"class":"cStartPortal","name":"StartPortal03","guid":[3415283602,2930724749,3175953031,3420113780],"spaceId":"kDefaultSpace","objectType":0},{"class":"cAudioSource","name":"BGM","guid":[1596674502,2319271992,2900844459,2801180766],"spaceId":"kDefaultSpace","objectType":-842150451},{"class":"cSkydome","name":"Sky","guid":[3956874685,1991789763,3220541584,1456680764],"spaceId":"kDefaultSpace","objectType":-842150451},{"class":"cFolderObject","name":"Players","guid":[3397398191,850542637,3138524115,1333674022],"spaceId":"kDefaultSpace","objectType":0},{"class":"cPlayerInstanceSlot","name":"PlayerInstanceSlot","guid":[718760084,1257915969,2962466066,2150526306],"spaceId":"kDefaultSpace","objectType":0},{"class":"cPlayerInstanceSlot","name":"PlayerInstanceSlot","guid":[438081159,4019275113,2394302102,997050187],"spaceId":"kDefaultSpace","objectType":0},{"class":"cPlayerInstanceSlot","name":"PlayerInstanceSlot","guid":[154289415,229392516,2254790969,287930189],"spaceId":"kDefaultSpace","objectType":0},{"class":"cTerrainObject","name":"Terrain","guid":[2381081137,2979483093,3156488065,1492146101],"spaceId":"kDefaultSpace","objectType":0}],"ObjectsData":[{"class":"cWorkspace","name":"World","guid":[1981988479,3555894,2597800867,69741929],"parentGuid":[0,0,0,0],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"World"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sWorkspaceComponent","data":{}},{"id":11,"class":"sConfigPhysicsComponent","data":{"m_collisionGroupMaskFlags":[0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}]},{"class":"cWorkspace","name":"Global","guid":[344576033,1668630255,2683907297,2226597768],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Global"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sWorkspaceComponent","data":{}},{"id":11,"class":"sConfigPhysicsComponent","data":{"m_collisionGroupMaskFlags":[0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}]},{"class":"cScriptObject","name":"AutoAssignTeamScript","guid":[1988307774,2442019711,2592872571,1277204125],"parentGuid":[344576033,1668630255,2683907297,2226597768],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"AutoAssignTeamScript"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 玩家加入\r\n-- @script Auto assign\r\n-- @copyright Lilith Games, Avatar Team\r\n\r\n--- 编辑器默认方法\r\n-- run once when script init\r\nfunction autoAssign()\r\n    local container = world:FindTeams()\r\n    local min = 1\r\n    local teamTojoin = {}\r\n    local playerfolder = world.Players\r\n    for i = 1, #container, 1 do\r\n        if container[i].CurrentMaxMemberNum > 0 then\r\n            temp = container[i].CurrentMemberNum / (container[i].CurrentMaxMemberNum)\r\n            if (temp < min and temp ~= 1) then\r\n                teamTojoin = {}\r\n                min = temp\r\n                table.insert(teamTojoin, container[i])\r\n            elseif temp == min and temp ~= 1 then\r\n                table.insert(teamTojoin, container[i])\r\n            end\r\n        end\r\n    end\r\n    local a = 1\r\n    if #teamTojoin > 0 then\r\n        a = math.random(1, #teamTojoin)\r\n        return teamTojoin[a]\r\n    else\r\n        return nil\r\n    end\r\nend\r\n"}}]},{"class":"cScriptObject","name":"LuaFunctionScript","guid":[3330332978,589909841,2774054172,1565862559],"parentGuid":[344576033,1668630255,2683907297,2226597768],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"LuaFunctionScript"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 提供一组常用函数，以及对 Lua 标准库的扩展\r\n-- @script Lua function extension libraries\r\n-- @author Lilith Games, Avatar Team\r\n-- @see https://wiki.lilithgames.com/x/tSkMAg\r\n\r\n--- 检查并尝试转换为数值，如果无法转换则返回 0\r\n-- @param mixed value 要检查的值\r\n-- @param [integer base] 进制，默认为十进制\r\n-- @return number\r\nfunction checknumber(value, base)\r\n    return tonumber(value, base) or 0\r\nend\r\n\r\n--- 检查是否是有效的number类型\r\n-- @param number\r\nfunction isValidNumber(num)\r\n    return num ~= nil and num > 0\r\nend\r\n\r\n--- 检查并尝试转换为整数，如果无法转换则返回 0\r\n-- @param mixed value 要检查的值\r\n-- @return integer\r\nfunction checkint(value)\r\n    return math.round(checknumber(value))\r\nend\r\n\r\n--- 检查并尝试转换为布尔值，除了 nil 和 false，其他任何值都会返回 true\r\n-- @param mixed value 要检查的值\r\n-- @return boolean\r\nfunction checkbool(value)\r\n    return (value ~= nil and value ~= false)\r\nend\r\n\r\n--- 检查值是否是一个表格，如果不是则返回一个空表格\r\n-- @param mixed value 要检查的值\r\n-- @return table\r\nfunction checktable(value)\r\n    if type(value) ~= 'table' then\r\n        value = {}\r\n    end\r\n    return value\r\nend\r\n\r\n--- 处理对象\r\n-- @param mixed obj Lua 对象\r\n-- @param function method 对象方法\r\n-- @return function\r\nfunction handler(obj, method)\r\n    return function(...)\r\n        return method(obj, ...)\r\n    end\r\nend\r\n\r\n--- 计算表格包含的字段数量\r\n-- Lua table 的 \"#\" 操作只对依次排序的数值下标数组有效，table.nums() 则计算 table 中所有不为 nil 的值的个数。\r\n-- @param table\r\nfunction table.nums(t)\r\n    if t == nil then\r\n        return 0\r\n    end\r\n    local count = 0\r\n    for k, v in pairs(t) do\r\n        count = count + 1\r\n    end\r\n    return count\r\nend\r\n\r\n--- 返回指定表格中的所有键\r\n-- @param k-v table\r\n-- @return keys' table\r\n-- @usage example\r\n-- local hashtable = {a = 1, b = 2, c = 3}\r\n-- local keys = table.keys(hashtable)\r\n-- >> keys = {\"a\", \"b\", \"c\"}\r\nfunction table.keys(hashtable)\r\n    local keys = {}\r\n    for k, _ in pairs(hashtable) do\r\n        table.insert(keys, k)\r\n    end\r\n    return keys\r\nend\r\n\r\n--- 返回指定表格中的所有值\r\n-- @param k-v table\r\n-- @return values' table\r\n-- @usage example\r\n-- local hashtable = {a = 1, b = 2, c = 3}\r\n-- local values = table.values(hashtable)\r\n-- >> values = {1, 2, 3}\r\nfunction table.values(hashtable)\r\n    local values = {}\r\n    local i = 1\r\n    for k, v in pairs(hashtable) do\r\n        values[i] = v\r\n        i = i + 1\r\n    end\r\n    return values\r\nend\r\n\r\n--- 将来源表格中所有键及其值复制到目标表格对象中，如果存在同名键，则覆盖其值\r\n-- @param target table\r\n-- @param source table\r\n-- @usage example\r\n-- local dest = {a = 1, b = 2}\r\n-- local src  = {c = 3, d = 4}\r\n-- table.merge(dest, src)\r\n-- >> dest = {a = 1, b = 2, c = 3, d = 4}\r\nfunction table.merge(dest, src)\r\n    for k, v in pairs(src) do\r\n        dest[k] = v\r\n    end\r\nend\r\n\r\n--- 在目标表格的指定位置插入来源表格，如果没有指定位置则连接两个表格\r\n-- @param target table\r\n-- @param source table\r\n-- @param start index\r\n-- @usage example #1\r\n-- local dest = {1, 2, 3}\r\n-- local src  = {4, 5, 6}\r\n-- table.insertto(dest, src)\r\n-- >> dest = {1, 2, 3, 4, 5, 6}\r\n-- @usage example #2\r\n-- local dest = {1, 2, 3}\r\n-- local src  = {4, 5, 6}\r\n-- table.insertto(dest, src, 5)\r\n-- >> dest = {1, 2, 3, nil, 4, 5, 6}\r\nfunction table.insertto(dest, src, begin)\r\n    if begin == nil then\r\n        begin = #dest + 1\r\n    else\r\n        begin = checkint(begin)\r\n        if begin <= 0 then\r\n            begin = #dest + 1\r\n        end\r\n    end\r\n\r\n    local len = #src\r\n    for i = 0, len - 1 do\r\n        dest[i + begin] = src[i + 1]\r\n    end\r\nend\r\n\r\n--- 从表格中查找指定值，返回其索引，如果没找到返回 false\r\n-- @param array table\r\n-- @param target value\r\n-- @param start index\r\n-- @return index or false\r\n-- @usage example\r\n-- local array = {\"a\", \"b\", \"c\"}\r\n-- print(table.indexof(array, \"b\"))\r\n-- >> 2\r\nfunction table.indexof(array, value, begin)\r\n    if array ~= nil then\r\n        for i = begin or 1, #array do\r\n            if array[i] == value then\r\n                return i\r\n            end\r\n        end\r\n    end\r\n    return 0\r\nend\r\n\r\n--- 检查表格中是否存在指定值\r\n-- @param array table\r\n-- @param target value\r\n-- @return @boolean\r\nfunction table.exists(array, value)\r\n    return table.indexof(array, value) > 0\r\nend\r\n\r\n--- 清空数组表格\r\n-- @param array table\r\nfunction table.cleararray(array)\r\n    if array ~= nil then\r\n        local count = #array\r\n        while count > 0 do\r\n            table.remove(array, count)\r\n            count = #array\r\n        end\r\n    end\r\nend\r\n\r\n--- 清空k-v表格\r\n-- @param k-v table\r\nfunction table.clearhashtable(hashtable)\r\n    if hashtable ~= nil then\r\n        for k, v in pairs(hashtable) do\r\n            hashtable[k] = nil\r\n        end\r\n    end\r\nend\r\n\r\n--- 清空表格\r\n-- @param table\r\n-- @see table.clearhashtable\r\nfunction table.cleartable(t)\r\n    table.clearhashtable(t)\r\nend\r\n\r\n--- 截取Array其中一段，startIndex从1开始 return截取后的新数组\r\n-- @param table array table\r\n-- @param @number start index\r\n-- @param @number length\r\n-- @return @table array table\r\n-- @usage example\r\n-- local array = {\"a\", \"b\", \"c\", \"d\"}\r\n-- print(table.subArray(array, 2, 2))\r\n-- >> {\"b\", \"c\"}\r\nfunction table.subArray(array, startIndex, length)\r\n    if array ~= nil then\r\n        local count = table.nums(array)\r\n        local tempArray = array\r\n        array = {}\r\n        if startIndex <= count then\r\n            local maxlength = count - startIndex + 1\r\n            length = length > maxlength and maxlength or length\r\n            local endIndex = startIndex + length - 1\r\n            for i = startIndex, endIndex do\r\n                table.insert(array, tempArray[i])\r\n            end\r\n        end\r\n    end\r\n    return array\r\nend\r\n\r\n--- 截取Array的后半段，startIndex从1开始 return截取后的新数组\r\n-- @param table array table\r\n-- @param @number start index\r\n-- @return @table array table\r\nfunction table.subArrayByStartIndex(array, startIndex)\r\n    if array ~= nil then\r\n        local count = table.nums(array)\r\n        local length = count - startIndex + 1\r\n        return table.subArray(array, startIndex, length)\r\n    end\r\n    return array\r\nend\r\n\r\n--- 从表格中查找指定值，返回其 key，如果没找到返回 nil\r\n-- @param table hash table\r\n-- @param any value\r\n-- @return key of value\r\n-- @usage\r\n-- local hashtable = {name = \"dualface\", comp = \"chukong\"}\r\n-- print(table.keyof(hashtable, \"chukong\"))\r\n-- >> comp\r\nfunction table.keyof(hashtable, value)\r\n    for k, v in pairs(hashtable) do\r\n        if v == value then\r\n            return k\r\n        end\r\n    end\r\n    return nil\r\nend\r\n\r\n--- 从表格中删除指定值，返回删除的值的个数\r\n-- @usage\r\n-- local array = {\"a\", \"b\", \"c\", \"c\"}\r\n-- print(table.removebyvalue(array, \"c\", true))\r\n-- >> 输出 2\r\nfunction table.removebyvalue(array, value, removeall)\r\n    local c, i, max = 0, 1, #array\r\n    while i <= max do\r\n        if array[i] == value then\r\n            table.remove(array, i)\r\n            c = c + 1\r\n            i = i - 1\r\n            max = max - 1\r\n            if not removeall then\r\n                break\r\n            end\r\n        end\r\n        i = i + 1\r\n    end\r\n    return c\r\nend\r\n\r\n--- 对表格中每一个值执行一次指定的函数，并用函数返回值更新表格内容\r\n-- @param table\r\n-- @param function fn 参数指定的函数具有两个参数，并且返回一个值。原型如下：\r\n-- function map_function(value, key)\r\n--     return value\r\n-- end\r\n-- @usage\r\n-- local t = {name = \"dualface\", comp = \"chukong\"}\r\n-- table.map(t, function(v, k)\r\n--    -- 在每一个值前后添加括号\r\n--    return \"[\" .. v .. \"]\"\r\n-- end)\r\n-- 输出修改后的表格内容\r\n-- for k, v in pairs(t) do\r\n--     print(k, v)\r\n-- end\r\n-- >> 输出\r\n-- name [dualface]\r\n-- comp [chukong]\r\nfunction table.map(t, fn)\r\n    for k, v in pairs(t) do\r\n        t[k] = fn(v, k)\r\n    end\r\nend\r\n\r\n--- 对表格中每一个值执行一次指定的函数，但不改变表格内容\r\n-- @param table\r\n-- @param function fn 参数指定的函数具有两个参数，没有返回值。原型如下：\r\n-- function map_function(value, key)\r\n--     -- no return here\r\n-- end\r\n-- @usage\r\n-- local t = {name = \"dualface\", comp = \"chukong\"}\r\n-- table.walk(t, function(v, k)\r\n--     -- 输出每一个值\r\n--     print(v)\r\n-- end)\r\nfunction table.walk(t, fn)\r\n    for k, v in pairs(t) do\r\n        fn(v, k)\r\n    end\r\nend\r\n\r\n--- 对表格中每一个值执行一次指定的函数，如果该函数返回 false，则对应的值会从表格中删除\r\n-- @param table\r\n-- @param function fn 参数指定的函数具有两个参数，并且返回一个 boolean 值。原型如下：\r\n-- !!!!该方法有局限性，执行后会修改原表格t中值\r\n-- function map_function(value, key)\r\n--     return true or false\r\n-- end\r\n-- @usage\r\n-- local t = {name = \"dualface\", comp = \"chukong\"}\r\n-- table.filter(t, function(v, k)\r\n--     return v ~= \"dualface\" -- 当值等于 dualface 时过滤掉该值\r\n-- end)\r\n-- 输出修改后的表格内容\r\n-- for k, v in pairs(t) do\r\n--     print(k, v)\r\n-- end\r\n-- >> 输出 comp chukong\r\nfunction table.filter(t, fn)\r\n    for k, v in pairs(t) do\r\n        if not fn(v, k) then\r\n            t[k] = nil\r\n        end\r\n    end\r\nend\r\n\r\n--- 找到表格中每个符合matchFunc的条目\r\n-- @param array table\r\n-- @param match function, return T/F\r\n-- @return all elements matched, default is {}\r\nfunction table.findAll(array, matchFunc)\r\n    local ret, idx = {}, 1\r\n    for i = 1, #array do\r\n        if matchFunc(array[i]) then\r\n            ret[idx] = array[i]\r\n            idx = idx + 1\r\n        end\r\n    end\r\n    return ret\r\nend\r\n\r\n--- 找到表格中每个符合matchFunc的条目，并执行walkFunc\r\n-- @param array table\r\n-- @param match function, return T/F\r\n-- @param walk function\r\nfunction table.findAllAndWalk(array, matchFunc, walkFunc)\r\n    for i = 1, #array do\r\n        if matchFunc(array[i]) then\r\n            walkFunc(array[i])\r\n        end\r\n    end\r\nend\r\n\r\n--- 在表格中插入一个新值\r\n-- @param array table\r\n-- @param new element\r\nfunction table.insert_once(T, elem)\r\n    for _, v in ipairs(T) do\r\n        if v == elem then\r\n            return\r\n        end\r\n    end\r\n    table.insert(T, elem)\r\nend\r\n\r\n--- 遍历表格，确保其中的值唯一\r\n-- @function [parent=#table] unique\r\n-- @param table t 表格\r\n-- @param boolean bArray t是否是数组,是数组,t中重复的项被移除后,后续的项会前移\r\n-- @return table#table  包含所有唯一值的新表格\r\n-- @usage\r\n-- 遍历表格，确保其中的值唯一\r\n-- local t = {\"a\", \"a\", \"b\", \"c\"} -- 重复的 a 会被过滤掉\r\n-- local n = table.unique(t)\r\n-- for k, v in pairs(n) do\r\n--     print(v)\r\n-- end\r\n-- >> 输出 a b c\r\nfunction table.unique(t, bArray)\r\n    local check = {}\r\n    local n = {}\r\n    local idx = 1\r\n    for k, v in pairs(t) do\r\n        if not check[v] then\r\n            if bArray then\r\n                n[idx] = v\r\n                idx = idx + 1\r\n            else\r\n                n[k] = v\r\n            end\r\n            check[v] = true\r\n        end\r\n    end\r\n    return n\r\nend\r\n\r\n--- table 深度复制\r\n-- @param table\r\n-- @return a net table with same data\r\nfunction table.deepcopy(object)\r\n    local lookup_table = {}\r\n    local function _copy(object)\r\n        if type(object) ~= 'table' then\r\n            return object\r\n        elseif lookup_table[object] then\r\n            return lookup_table[object]\r\n        end\r\n        local new_table = {}\r\n        lookup_table[object] = new_table\r\n        for key, value in pairs(object) do\r\n            new_table[_copy(key)] = _copy(value)\r\n        end\r\n        return setmetatable(new_table, getmetatable(object))\r\n    end\r\n    return _copy(object)\r\nend\r\n\r\n--- table 浅度复制(不处理metatable)\r\nfunction table.shallowcopy(orig)\r\n    local orig_type = type(orig)\r\n    local copy\r\n    if orig_type == 'table' then\r\n        --        setmetatable(copy,table.deepcopy2(getmetatable(orig)))\r\n        copy = {}\r\n        for orig_key, orig_value in next, orig, nil do\r\n            copy[table.shallowcopy(orig_key)] = table.shallowcopy(orig_value)\r\n        end\r\n    else\r\n        copy = orig\r\n    end\r\n    return copy\r\nend\r\n\r\n--- 获取or创建一个子表\r\nfunction table.need(tb, key)\r\n    if type(tb) == 'table' then\r\n        local subTb = tb[key]\r\n        if subTb == nil then\r\n            subTb = {}\r\n            tb[key] = subTb\r\n        end\r\n        return subTb\r\n    end\r\n    return\r\nend\r\n\r\n--- 打印table中的所有内容\r\n-- @param data table\r\n-- @param @boolean showMetatable 是否显示元表\r\nfunction table.dump(data, showMetatable)\r\n    local result, tab = {}, '    '\r\n    local function _dump(data, showMetatable, lastCount)\r\n        if type(data) ~= 'table' then\r\n            if type(data) == 'string' then\r\n                table.insert(result, '\"')\r\n                table.insert(result, data)\r\n                table.insert(result, '\"')\r\n            else\r\n                table.insert(result, tostring(data))\r\n            end\r\n        else\r\n            --Format\r\n            local count = lastCount or 0\r\n            count = count + 1\r\n            table.insert(result, '{\\n')\r\n            --Metatable\r\n            if showMetatable then\r\n                for i = 1, count do\r\n                    table.insert(result, tab)\r\n                end\r\n                local mt = getmetatable(data)\r\n                table.insert(result, '\"__metatable\" = ')\r\n                _dump(mt, showMetatable, count)\r\n                table.insert(result, ',\\n')\r\n            end\r\n            --Key\r\n            for key, value in pairs(data) do\r\n                for i = 1, count do\r\n                    table.insert(result, tab)\r\n                end\r\n                if type(key) == 'string' then\r\n                    table.insert(result, '\"')\r\n                    table.insert(result, key)\r\n                    table.insert(result, '\" = ')\r\n                elseif type(key) == 'number' then\r\n                    table.insert(result, '[')\r\n                    table.insert(result, key)\r\n                    table.insert(result, '] = ')\r\n                else\r\n                    table.insert(result, tostring(key))\r\n                end\r\n                _dump(value, showMetatable, count)\r\n                table.insert(result, ',\\n')\r\n            end\r\n            --Format\r\n            for i = 1, lastCount or 0 do\r\n                table.insert(result, tab)\r\n            end\r\n            table.insert(result, '}')\r\n        end\r\n        --Format\r\n        if not lastCount then\r\n            table.insert(result, '\\n')\r\n        end\r\n    end\r\n    _dump(data, showMetatable, 0)\r\n\r\n    print('dump from: \\n' .. table.concat(result))\r\nend\r\n\r\n--- 用指定字符或字符串分割输入字符串，返回包含分割结果的数组\r\n-- @param @string input 输入的字符串\r\n-- @param @string delimiter 分隔符\r\n-- @return array\r\n-- @usage example #1\r\n-- local input = \"Hello,World\"\r\n-- local res = string.split(input, \",\")\r\n-- >> res = {\"Hello\", \"World\"}\r\n-- @usage example #2\r\n-- local input = \"Hello-+-World-+-Quick\"\r\n-- local res = string.split(input, \"-+-\")\r\n-- >> res = {\"Hello\", \"World\", \"Quick\"}\r\nfunction string.split(input, delimiter)\r\n    input = tostring(input)\r\n    delimiter = tostring(delimiter)\r\n    if (delimiter == '') then\r\n        return false\r\n    end\r\n    local pos, arr = 0, {}\r\n    -- for each divider found\r\n    for st, sp in function()\r\n        return string.find(input, delimiter, pos, true)\r\n    end do\r\n        table.insert(arr, string.sub(input, pos, st - 1))\r\n        pos = sp + 1\r\n    end\r\n    table.insert(arr, string.sub(input, pos))\r\n    return arr\r\nend\r\n\r\n--- 判断字符串是否为空或者长度为零\r\n-- @param @string 输入的字符串\r\nfunction string.isnilorempty(inputStr)\r\n    return inputStr == nil or inputStr == ''\r\nend\r\n\r\n--- 去除输入字符串头部的空白字符，返回结果\r\n-- @param @string input\r\n-- @return @string\r\n-- @usage example\r\n-- local input = \"  ABC\"\r\n-- print(string.ltrim(input))\r\n-- >> 输出 ABC，输入字符串前面的两个空格被去掉了\r\n-- 空白字符包括：\r\n-- -   空格\r\n-- -   制表符 \\t\r\n-- -   换行符 \\n\r\n-- -   回到行首符 \\r\r\nfunction string.ltrim(input)\r\n    return string.gsub(input, '^[ \\t\\n\\r]+', '')\r\nend\r\n\r\n--- 去除输入字符串尾部的空白字符，返回结果\r\n-- @param @string input\r\n-- @return @string\r\n-- @usage example\r\n-- local input = \"ABC  \"\r\n-- print(string.rtrim(input))\r\n-- >> 输出 ABC，输入字符串最后的两个空格被去掉了\r\nfunction string.rtrim(input)\r\n    return string.gsub(input, '[ \\t\\n\\r]+$', '')\r\nend\r\n\r\n--- 去掉字符串首尾的空白字符，返回结果\r\n-- @param @string input\r\n-- @return @string\r\nfunction string.trim(input)\r\n    input = string.gsub(input, '^[ \\t\\n\\r]+', '')\r\n    return string.gsub(input, '[ \\t\\n\\r]+$', '')\r\nend\r\n\r\n--- 将字符串的第一个字符转为大写，返回结果\r\n-- @param @string input\r\n-- @return @string\r\n-- @usage example\r\n-- local input = \"hello\"\r\n-- print(string.ucfirst(input))\r\n-- >> 输出 Hello\r\nfunction string.ucfirst(input)\r\n    return string.upper(string.sub(input, 1, 1)) .. string.sub(input, 2)\r\nend\r\n\r\nfunction string.firstToUpper(str)\r\n    return (str:gsub('^%l', string.upper))\r\nend\r\n\r\n--- 计算 UTF8 字符串的长度，每一个中文算一个字符\r\n-- @param @string input\r\n-- @return @number cnt\r\n-- @usage example\r\n-- local input = \"你好World\"\r\n-- print(string.utf8len(input))\r\n-- >> 输出 7\r\nfunction string.utf8len(input)\r\n    local len = string.len(input)\r\n    local left = len\r\n    local cnt = 0\r\n    local arr = {0, 0xc0, 0xe0, 0xf0, 0xf8, 0xfc}\r\n    while left ~= 0 do\r\n        local tmp = string.byte(input, -left)\r\n        local i = #arr\r\n        while arr[i] do\r\n            if tmp >= arr[i] then\r\n                left = left - i\r\n                break\r\n            end\r\n            i = i - 1\r\n        end\r\n        cnt = cnt + 1\r\n    end\r\n    return cnt\r\nend\r\n\r\n--- 替换字符串内容\r\n-- @param @string input\r\n-- @param @number start index\r\n-- @param new context\r\n-- @return a new string\r\nfunction string.replace(str, index, char)\r\n    return table.concat {str:sub(1, index - 1), char, str:sub(index + 1)}\r\nend\r\n\r\n--- 检查字符串是否为指定字符串开头\r\n-- @param @string target\r\n-- @param @string start\r\n-- @return @boolean\r\nfunction string.startswith(str, start)\r\n    return str:sub(1, #start) == start\r\nend\r\n\r\n--- 检查字符串是否以指定字符串结尾\r\n-- @param @string target\r\n-- @param @string start\r\n-- @return @boolean\r\nfunction string.endswith(str, ending)\r\n    return ending == '' or str:sub(-(#ending)) == ending\r\nend\r\n\r\n--- 四舍五入\r\n-- @param a number\r\n-- @return a round number\r\nfunction math.round(value)\r\n    return math.floor(value + 0.5)\r\nend\r\n\r\n--- [0, 1]区间限定函数\r\n-- @param a number or\r\n-- @return a clamped number\r\nfunction math.clamp01(value)\r\n    return math.min(1, math.max(0, value))\r\nend\r\n\r\n--- 数据结构 队列\r\n-- @usage queue example\r\n-- local myQueue = Queue:New()\r\n-- myQueue:Enqueue('a')\r\n-- myQueue:Enqueue('b')\r\n-- myQueue:Enqueue('c')\r\n-- myQueue:PrintElement()\r\n-- print(myQueue:Dequeue())\r\n-- myQueue:PrintElement()\r\n-- myQueue:Clear()\r\n-- myQueue:PrintElement()\r\nQueue = {}\r\nfunction Queue:New()\r\n    local inst = {\r\n        _first = -1,\r\n        _last = -1,\r\n        _size = 0,\r\n        _queue = {}\r\n    }\r\n    setmetatable(inst, {__index = self})\r\n    return inst\r\nend\r\n\r\nfunction Queue:IsEmpty()\r\n    if self._size == 0 then\r\n        return true\r\n    end\r\n    return false\r\nend\r\n\r\nfunction Queue:Enqueue(inElement)\r\n    if self._size == 0 then\r\n        self._first = 0\r\n        self._last = 1\r\n        self._size = 1\r\n        self._queue[self._last] = inElement\r\n    else\r\n        self._last = self._last + 1\r\n        self._queue[self._last] = inElement\r\n        self._size = self._size + 1\r\n    end\r\nend\r\n\r\nfunction Queue:Dequeue()\r\n    if self:IsEmpty() then\r\n        print('Error: the queue is empty')\r\n        return\r\n    end\r\n    self._size = self._size - 1\r\n    self._first = self._first + 1\r\n    local value = self._queue[self._first]\r\n    return value\r\nend\r\n\r\nfunction Queue:Clear()\r\n    self._queue = nil\r\n    self._queue = {}\r\n    self._size = 0\r\n    self._first = -1\r\n    self._last = -1\r\nend\r\n\r\nfunction Queue:Size()\r\n    return self._size or 0\r\nend\r\n\r\nfunction Queue:PrintElement()\r\n    if self._size == 0 then\r\n        print('{}')\r\n    else\r\n        local f = self._first + 1\r\n        local l = self._last\r\n        local str\r\n        local flag = true\r\n        while f ~= l do\r\n            if flag == true then\r\n                str = '{' .. tostring(self._queue[f])\r\n                f = f + 1\r\n                flag = false\r\n            else\r\n                str = str .. ',' .. tostring(self._queue[f])\r\n                f = f + 1\r\n            end\r\n        end\r\n        str = str .. ',' .. tostring(self._queue[l]) .. '}'\r\n        print(str)\r\n    end\r\nend\r\n\r\nfunction Queue:GetValue(index)\r\n    if self:IsEmpty() or index == nil or index == 0 then\r\n        print('Error: Get Value Failure!')\r\n        return\r\n    end\r\n    if index > 0 then\r\n        return self._queue[self._first + index]\r\n    else\r\n        return self._queue[self._last + index + 1]\r\n    end\r\nend\r\n\r\nfunction Queue:GetValues()\r\n    if self:IsEmpty() then\r\n        return\r\n    end\r\n    local data = {}\r\n    for i = self._first + 1, self._last, 1 do\r\n        data[#data + 1] = self._queue[i]\r\n    end\r\n    return data\r\nend\r\n\r\n--- 数据结构 栈\r\n-- @usage example\r\n-- local myStack = Stack:New()\r\n-- myStack:Push(\"a\")\r\n-- myStack:Push(\"b\")\r\n-- myStack:Push(\"c\")\r\n-- myStack:PrintElement()\r\n-- print(myStack:Pop())\r\n-- myStack:PrintElement()\r\n-- myStack:Clear()\r\n-- myStack:PrintElement()\r\nStack = {}\r\nfunction Stack:New()\r\n    local inst = {\r\n        _last = 0,\r\n        _stack = {}\r\n    }\r\n    setmetatable(inst, {__index = self})\r\n\r\n    return inst\r\nend\r\n\r\nfunction Stack:IsEmpty()\r\n    if self._last == 0 then\r\n        return true\r\n    end\r\n    return false\r\nend\r\n\r\nfunction Stack:Push(inElement)\r\n    self._last = self._last + 1\r\n    self._stack[self._last] = inElement\r\nend\r\n\r\nfunction Stack:Pop()\r\n    if self:IsEmpty() then\r\n        --print(\"Error: the stack is empty\")\r\n        return\r\n    end\r\n    local value = self._stack[self._last]\r\n    self._stack[self._last] = nil\r\n    self._last = self._last - 1\r\n    return value\r\nend\r\n\r\nfunction Stack:Exists(element, compairFunc)\r\n    if compairFunc == nil then\r\n        compairFunc = function(a, b)\r\n            return a == b\r\n        end\r\n    end\r\n    for i = self._last, 1, -1 do\r\n        if compairFunc(element, self._stack[i]) then\r\n            return i\r\n        end\r\n    end\r\n    return -1\r\nend\r\n\r\nfunction Stack:RemoveAt(index)\r\n    if index < 1 or index > self._last then\r\n        return\r\n    end\r\n    table.remove(self._stack, index)\r\n    self._last = self._last - 1\r\nend\r\n\r\nfunction Stack:Clear()\r\n    self._stack = nil\r\n    self._stack = {}\r\n    self._last = 0\r\nend\r\n\r\nfunction Stack:Size()\r\n    return self._last\r\nend\r\n\r\nfunction Stack:PrintElement()\r\n    local str = '{'\r\n    for i = self._last, 1, -1 do\r\n        str = str .. tostring(self._stack[i]) .. ','\r\n    end\r\n    str = str .. '}'\r\n    print(str)\r\nend\r\n"}}]},{"class":"cScriptObject","name":"ModuleRequireScript","guid":[2221840009,1976321846,2245245619,407532979],"parentGuid":[344576033,1668630255,2683907297,2226597768],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ModuleRequireScript"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 将Global.Module目录下每一个用到模块提前require,定义为全局变量\r\n-- @script Module Defines\r\n-- @copyright Lilith Games, Avatar Team\r\n\r\n-- Utilities\r\nNetUtil = require(Utility.NetUtilModule)\r\nCsvUtil = require(Utility.CsvUtilModule)\r\nEventUtil = require(Utility.EventUitlModule)\r\n\r\n-- Defines\r\nGlobalDef = require(Define.GlobalDefModule)\r\nConstDef = require(Define.ConstDefModule)\r\n\r\n-- Server Modules\r\nGameMgr = require(Module.S_Module.GameMgrModule)\r\nCsvConfig = require(Module.S_Module.CsvConfigModule)\r\nExampleA = require(Module.S_Module.ExampleAModule)\r\n\r\n-- Client Modules\r\nPlayerMgr = require(Module.C_Module.PlayerMgrModule)\r\nExampleB = require(Module.C_Module.ExampleBModule)\r\n"}}]},{"class":"cFolderObject","name":"Utility","guid":[1158799413,2751941742,3186700785,1570109853],"parentGuid":[344576033,1668630255,2683907297,2226597768],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Utility"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cModuleScriptObject","name":"NetUtilModule","guid":[3138092138,940262650,3093420508,667201143],"parentGuid":[1158799413,2751941742,3186700785,1570109853],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"NetUtilModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 网路工具/事件工具\r\n-- @module Network utilities\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author Shang Ma, Yuancheng Zhang\r\nlocal NetUtil = {}\r\n\r\n--- 向指定的玩家发送消息\r\n-- @param @string _eventName 事件的名字\r\n-- @param _player 玩家对象\r\n-- @param ... 事件参数\r\nfunction NetUtil.Fire_C(_eventName, _player, ...)\r\n    if _player == nil or _player.ClassName ~= 'PlayerInstance' then\r\n        print('[错误] Fire_C 第二个参数需要是玩家对象')\r\n        return\r\n    end\r\n    if _player.C_Event[_eventName] == nil then\r\n        print(string.format('[错误] 玩家身上不存在%s事件', _eventName))\r\n        return\r\n    end\r\n    _player.C_Event[_eventName]:Fire(...)\r\n    print(string.format('[信息] 客户端事件: %s , 玩家: ', _eventName, _player.Name))\r\nend\r\n\r\n--- 向服务端发送消息\r\n-- @param @string _eventName 事件的名字(严格对应)\r\n-- @param ... 事件参数\r\nfunction NetUtil.Fire_S(_eventName, ...)\r\n    if world.S_Event[_eventName] == nil then\r\n        print(string.format('[错误] 服务端不存在%s事件', _eventName))\r\n        return\r\n    end\r\n    world.S_Event[_eventName]:Fire(...)\r\n    --print(...)\r\n    print(string.format('[信息] 服务器事件: %s', _eventName))\r\nend\r\n\r\n--- 客户端广播\r\n-- @param @string _eventName 事件的名字(严格对应)\r\n-- @param ... 事件参数\r\nfunction NetUtil.Broadcast(_eventName, ...)\r\n    print(string.format('[信息] 客户端广播事件: %s', _eventName))\r\n    world.Players:BroadcastEvent(_eventName, ...)\r\nend\r\n\r\nreturn NetUtil\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cModuleScriptObject","name":"CsvUtilModule","guid":[3433342930,3050064207,3042438006,35244977],"parentGuid":[1158799413,2751941742,3186700785,1570109853],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"CsvUtilModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 读表工具: 讲CSV导入成Lua Table，支持单一主键和多主键\r\n-- @module CSV Utility\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author Yuancheng Zhang\r\n-- @see https://wiki.lilithgames.com/x/RGEMAg\r\nlocal CsvUtil = {}\r\n\r\n--- 读取配置表,会根据id生成lua表\r\n-- @param _csv 表格\r\n-- @parma _id 表格的\r\n-- @parma _isPrimaryKey 是否为主键,默认值为true\r\n-- @usage exmaple #1 如果 _isPrimaryKey == true, 单一键值为主键\r\n-- Level.csv 表格内容为:\r\n-- ----------------------------------\r\n-- | String   | String     | Int    |\r\n-- | level_id | level_name | reward |\r\n-- | easy_01  | Level 01   | 100    |\r\n-- | easy_02  | Level 02   | 140    |\r\n-- | hard_01  | Level 03   | 280    |\r\n-- | hard_02  | Level 04   | 320    |\r\n-- ----------------------------------\r\n-- 调用函数 local levelCsv = CsvUtil.GetCsvInfo(Level, 'level_id', true) 导入的lua表格结果为:\r\n-- levelCsv = {\r\n--     easy_01 = {\r\n--         level_id = 'easy_01',\r\n--         level_name = 'Level 01',\r\n--         reward = 100\r\n--     },\r\n--     easy_02 = {\r\n--         level_id = 'easy_02',\r\n--         level_name = 'Level 02',\r\n--         reward = 140\r\n--     },\r\n--     hard_01 = {\r\n--         level_id = 'hard_01',\r\n--         level_name = 'Level 03',\r\n--         reward = 280\r\n--     },\r\n--     hard_02 = {\r\n--         level_id = 'hard_02',\r\n--         level_name = 'Level 04',\r\n--         reward = 320\r\n--     }\r\n-- }\r\n-- @usage exmaple #2 如果 _isPrimaryKey == false, 多键值为主键\r\n-- Enemy.csv 表格内容为:\r\n-- ----------------------------------\r\n-- | String   | String     | Int    |\r\n-- | enemy_id | difficulty | hp     |\r\n-- | foe_01   | easy       | 100    |\r\n-- | foe_01   | hard       | 150    |\r\n-- | foe_02   | easy       | 300    |\r\n-- | foe_02   | hard       | 400    |\r\n-- ----------------------------------\r\n-- 调用函数 local enemyCsv = CsvUtil.GetCsvInfo(Enemy, 'enemy_id', false) 导入的lua表格结果为:\r\n-- enemyCsv = {\r\n--     foe_01 = {\r\n--         [1] = {\r\n--             enemy_id = 'foe_01',\r\n--             difficulty = 'easy',\r\n--             hp = 100\r\n--         },\r\n--         [2] = {\r\n--             enemy_id = 'foe_02',\r\n--             difficulty = 'hard',\r\n--             hp = 150\r\n--         }\r\n--     },\r\n--     foe_02 = {\r\n--         [1] = {\r\n--             enemy_id = 'foe_02',\r\n--             difficulty = 'easy',\r\n--             hp = 300\r\n--         },\r\n--         [2] = {\r\n--             enemy_id = 'foe_02',\r\n--             difficulty = 'hard',\r\n--             hp = 400\r\n--         }\r\n--     }\r\n-- }\r\nfunction CsvUtil.GetCsvInfo(_csv, _id, _isPrimaryKey)\r\n    _isPrimaryKey = _isPrimaryKey or _isPrimaryKey == nil -- default is true\r\n    local tmp = _csv:GetRows()\r\n    local result = {}\r\n    if _id == 'Type' then\r\n        for _, v in pairs(tmp) do\r\n            table.insert(result, v)\r\n        end\r\n    else\r\n        for k, v in pairs(tmp) do\r\n            if v[_id] == nil then\r\n                print(string.format('CSV缺少参数：csv:%s, _id:%s', _csv.Name, _id))\r\n                return\r\n            end\r\n            if _isPrimaryKey then\r\n                -- id是唯一主键\r\n                if result[v[_id]] ~= nil then\r\n                    print(string.format('CSV数据覆盖：csv:%s, _id:%s', _csv.Name, _id))\r\n                end\r\n                result[v[_id]] = v\r\n                v.Type = tonumber(k)\r\n            else\r\n                -- id不是主键,合并同id的数据\r\n                if result[v[_id]] == nil then\r\n                    result[v[_id]] = {}\r\n                end\r\n                table.insert(result[v[_id]], v)\r\n            end\r\n        end\r\n    end\r\n    print(string.format('CSV数据载入: _csv:%s', _csv.Name))\r\n    return result\r\nend\r\n\r\nreturn CsvUtil\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cModuleScriptObject","name":"EventUitlModule","guid":[2990017477,1670333273,2674323178,1532840206],"parentGuid":[1158799413,2751941742,3186700785,1570109853],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"EventUitlModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 事件绑定工具\r\n-- @module Event Connects Handler\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author Yuancheng Zhang\r\nlocal EventUtil = {}\r\n\r\n--- 遍历所有的events,找到module中对应名称的handler,建立Connect\r\n-- @param _eventFolder 事件所在的节点folder\r\n-- @param _module 模块\r\n-- @param _moduleName module的名字,用于打印日志\r\n-- @param _this module的self指针,用于闭包\r\nfunction EventUtil.LinkConnects(_eventFolder, _module, _moduleName, _this)\r\n    local events = _eventFolder:GetChildren()\r\n    local total = 0\r\n    for _, ent in pairs(events) do\r\n        if string.endswith(ent.Name, 'Event') then\r\n            local handler = _module[ent.Name .. 'Handler']\r\n            if handler ~= nil then\r\n                ent:Connect(\r\n                    function(...)\r\n                        handler(_this, ...)\r\n                    end\r\n                )\r\n                print(string.format('[信息] %s/%s 事件绑定%s成功', _eventFolder.Name, ent.Name, _moduleName))\r\n                total = total + 1\r\n            end\r\n        else\r\n            print(string.format('[警告] S_Event/%s 命名没有以Event结尾', ent.Name))\r\n        end\r\n    end\r\n    print(string.format('[信息] %s共绑定%s个事件', _moduleName, total))\r\nend\r\n\r\nreturn EventUtil\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cFolderObject","name":"Plugin","guid":[3421449223,220021494,2714239174,1946870819],"parentGuid":[344576033,1668630255,2683907297,2226597768],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Plugin"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cFolderObject","name":"FUNC_UIAnimation","guid":[1331349991,2616282402,2630754420,1905460436],"parentGuid":[3421449223,220021494,2714239174,1946870819],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"FUNC_UIAnimation"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cModuleScriptObject","name":"ReadMe","guid":[2979943216,551765364,2248158137,2732055024],"parentGuid":[1331349991,2616282402,2630754420,1905460436],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ReadMe"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--[[\r\n\r\n播放动画:\r\nStartAnimationEvent:Fire(string _AnimationName,bool _isRunBack)\r\n\t_AnimationName:需要播放的动画名称\r\n\t _isRunBack:是否倒放,true为倒放,缺省或false为倒放\r\n监听动画状态:\r\nAnimationStateEvent:Connect(function(_string AnimationName, _string Tag) end)\r\n\t_AnimationName:监听的动画名称 \r\n\t_Tag:动画状态.默认在设置完初始帧后返回'Start',在完成最后一帧后返回'Complete'.在设置有Tag的关键帧处返回Tag\r\n\t\r\n配置表:\r\n!!!!!!!!!!注:因为配置表不填会有默认数据,所以配置表中0与0,0被设置为了无效数据,需要零值的可以用0.01代替!!!!!!!\r\n\r\nType:默认字段\r\nAnimationName:动画名,同一段动画可以设置多个UI控件的改变,作为StartAnimationEvent的参数传入\r\nCount:总帧数,在每段动画的第一行填写,播放完该帧后则停止该段动画播放并传回'Complete'\r\nUINode:动画所绑定的UI控件节点,目前仅支持Local下的动画节点,以Local.开头,否则无法找到动画节点.每个节点的动画帧独立设置\r\nIsInit:是否为初始帧,每一个UI节点动画的第一行配置该节点的初始状态,将IsInit设置为true,KeyFrame设置为0.初始帧会在动画播放前设置完毕,然后传回'Start'\r\nKeyFrame:关键帧,单位为\"帧\",必须按顺序设置,0帧为初始帧.如果乱序设置会出现未知的错误\r\nSize..Alpha:各项UI属性\r\nTag:动画监听标签,在播放到该帧的时候会将Tag传回监听事件中\r\nType:速度变化方式,枚举值,目前仅有'Linear',缺省默认'Linear'\r\n\r\n同一个界面同时的动画需要写在同一段动画中,目前不允许同时播放两段动画,避免意外的错误\r\n\r\n--]]\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cCustomEventObject","name":"StartAnimationEvent","guid":[422217733,3439480519,2787533495,3744167565],"parentGuid":[1331349991,2616282402,2630754420,1905460436],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"StartAnimationEvent"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":511,"class":"sCustomEventComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--自定义事件脚本, 会监听由FireEventTo系列触发的与该脚本名一样的事件\r\n--参数(arg1, arg2, arg3 ...) : 为各个事件参数\r\n--arg1:要播放的动画数据名称,以Module形式储存在Animation下\r\n","m_scriptType":"kCustomFunction"}}]},{"class":"cCustomEventObject","name":"AnimationStateEvent","guid":[2240976140,335758174,2687189224,322413573],"parentGuid":[1331349991,2616282402,2630754420,1905460436],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"AnimationStateEvent"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":511,"class":"sCustomEventComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--自定义事件脚本, 会监听由FireEventTo系列触发的与该脚本名一样的事件\r\n--参数(arg1, arg2, arg3 ...) : 为各个事件参数\r\nprint('UIAnimation:', arg1, 'State:', arg2)\r\n","m_scriptType":"kCustomFunction"}}]},{"class":"cFolderObject","name":"Code","guid":[2747130650,1726107529,2983478535,4170811724],"parentGuid":[1331349991,2616282402,2630754420,1905460436],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Code"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cScriptObject","name":"AnimationMain","guid":[3270875816,3576709130,2580715786,62020743],"parentGuid":[2747130650,1726107529,2983478535,4170811724],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"AnimationMain"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--该脚本为动画主要函数代码\r\nwait()\r\nlocal DataModule = require(script.Parent.DataModule)\r\nDataModule:Init()\r\n\r\nlocal OnPlay = false\r\n\r\n--为一个UI赋值\r\nfunction InsertParameter(UIObj, ParaTable, DataName)\r\n    if ParaTable.Size then\r\n        UIObj.Size = ParaTable.Size\r\n    end\r\n    if ParaTable.AnchorsX then\r\n        UIObj.AnchorsX = ParaTable.AnchorsX\r\n    end\r\n    if ParaTable.AnchorsY then\r\n        UIObj.AnchorsY = ParaTable.AnchorsY\r\n    end\r\n    if ParaTable.Angle then\r\n        UIObj.Angle = ParaTable.Angle\r\n    end\r\n    if ParaTable.Offset then\r\n        UIObj.Offset = ParaTable.Offset\r\n    end\r\n    if ParaTable.Alpha then\r\n        UIObj.Alpha = ParaTable.Alpha\r\n        for k, v in pairs(UIObj:GetChildren()) do\r\n            if v.Alpha then\r\n                v.Alpha = ParaTable.Alpha\r\n            end\r\n            for k2, v2 in pairs(v:GetChildren()) do\r\n                if v2.Alpha then\r\n                    v2.Alpha = ParaTable.Alpha\r\n                end\r\n            end\r\n        end\r\n    end\r\n    if ParaTable.Tag then\r\n        script.Parent.Parent.AnimationStateEvent:Fire(DataName, ParaTable.Tag)\r\n    end\r\nend\r\n\r\nfunction StartAnimation(DataName, isBackRun)\r\n    --判断是否已经有动画正在播放中\r\n    if OnPlay then\r\n        print('不允许同时播放两段动画')\r\n        return\r\n    end\r\n\r\n    OnPlay = true\r\n\r\n    DataModule:Calculate(DataName)\r\n    Data = DataModule.Data[DataName]\r\n    if Data.count == nil or Data.count == 0 then\r\n        print('配表错误,请填写动画数据的帧数')\r\n        return\r\n    end\r\n    if isBackRun == nil or isBackRun == false then\r\n        for k, v in pairs(Data) do\r\n            if k ~= 'count' then\r\n                InsertParameter(v.Obj, v.Init)\r\n            end\r\n        end\r\n        script.Parent.Parent.AnimationStateEvent:Fire(DataName, 'Start')\r\n        for i = 1, Data.count do\r\n            wait(0.016)\r\n            for k, v in pairs(Data) do\r\n                if k ~= 'count' and v.PerFrame[i] then\r\n                    InsertParameter(v.Obj, v.PerFrame[i], DataName)\r\n                end\r\n            end\r\n        end\r\n    elseif isBackRun == true then\r\n        for k, v in pairs(Data) do\r\n            if k ~= 'count' then\r\n                InsertParameter(v.Obj, v.PerFrame[#v.PerFrame])\r\n            end\r\n        end\r\n        script.Parent.Parent.AnimationStateEvent:Fire(DataName, 'Start')\r\n        for i = 1, Data.count do\r\n            wait(0.016)\r\n            for k, v in pairs(Data) do\r\n                if k ~= 'count' and v.PerFrame[Data.count - i + 1] then\r\n                    InsertParameter(v.Obj, v.PerFrame[Data.count - i + 1], DataName)\r\n                end\r\n            end\r\n        end\r\n    end\r\n    script.Parent.Parent.AnimationStateEvent:Fire(DataName, 'Complete')\r\n    OnPlay = false\r\nend\r\n\r\nscript.Parent.Parent.StartAnimationEvent:Connect(StartAnimation)\r\n"}}]},{"class":"cModuleScriptObject","name":"DataModule","guid":[248227229,1371949624,2628757272,720694732],"parentGuid":[2747130650,1726107529,2983478535,4170811724],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"DataModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"local DataModule = {Data = {}}\r\n\r\n--初始化函数,读取动画表\r\nfunction DataModule:Init()\r\n    local InfoTable = world.Global.Csv.UIAnimation\r\n    local RowNum = InfoTable:GetRowNum()\r\n    for i = 1, RowNum do\r\n        local AnimationName = InfoTable:GetCell('AnimationName', i)\r\n        --如果该数据的动画名为新增,则在数据表中新插入一段空的动画数据\r\n        if self.Data[AnimationName] == nil then\r\n            self.Data[AnimationName] = {}\r\n            self.Data[AnimationName].count = InfoTable:GetCell('Count', i)\r\n        end\r\n\r\n        --解析UI节点路径,获取UI节点\r\n        local PathStr = InfoTable:GetCell('UINode', i)\r\n        local UiPath = string.split(InfoTable:GetCell('UINode', i), '.')\r\n        local UiNode\r\n        if UiPath[1] == 'Local' then\r\n            UiNode = localPlayer\r\n            for k, v in pairs(UiPath) do\r\n                if UiNode[v] then\r\n                    UiNode = UiNode[v]\r\n                else\r\n                    print('AnimationName = ', AnimationName, 'The Path NotFind:', v, 'in', UiPath)\r\n                    return\r\n                end\r\n            end\r\n        else\r\n            print('暂时不支持Local以外的UI节点动画')\r\n            return\r\n        end\r\n\r\n        --判断初始帧,并执行初始帧逻辑\r\n        if InfoTable:GetCell('IsInit', i) == true then\r\n            --记录初始帧\r\n            self.Data[AnimationName][PathStr] = {}\r\n            local NowData = self.Data[AnimationName][PathStr]\r\n            NowData.Obj = UiNode\r\n            NowData.KeyFrame = {}\r\n            NowData.Init = {}\r\n            NowData.PerFrame = {}\r\n            if InfoTable:GetCell('Size', i) ~= Vector2(0, 0) then\r\n                NowData.Init.Size = InfoTable:GetCell('Size', i)\r\n            end\r\n            if InfoTable:GetCell('AnchorsX', i) ~= Vector2(0, 0) then\r\n                NowData.Init.AnchorsX = InfoTable:GetCell('AnchorsX', i)\r\n            end\r\n            if InfoTable:GetCell('AnchorsY', i) ~= Vector2(0, 0) then\r\n                NowData.Init.AnchorsY = InfoTable:GetCell('AnchorsY', i)\r\n            end\r\n            if InfoTable:GetCell('Angle', i) ~= 0 then\r\n                NowData.Init.Angle = InfoTable:GetCell('Angle', i)\r\n            end\r\n            if InfoTable:GetCell('Offset', i) ~= Vector2(0, 0) then\r\n                NowData.Init.Offset = InfoTable:GetCell('Offset', i)\r\n            end\r\n            if InfoTable:GetCell('Alpha', i) ~= 0 then\r\n                NowData.Init.Alpha = InfoTable:GetCell('Alpha', i)\r\n            end\r\n        else\r\n            --配置表初始帧配置校验\r\n            if self.Data[AnimationName][PathStr] == nil then\r\n                print(AnimationName, '未配置初始帧,配表错误')\r\n                return\r\n            end\r\n            local tFrame, tSize, tAnchorsX, tAnchorsY, tAngle, tOffset, tAlpha, tTag\r\n            --记录关键帧数据\r\n            tType = InfoTable:GetCell('Type', i)\r\n            if tType == '' then\r\n                tType = 'Linear'\r\n            end\r\n            if InfoTable:GetCell('KeyFrame', i) ~= Vector2(0, 0) then\r\n                tFrame = InfoTable:GetCell('KeyFrame', i)\r\n            end\r\n            if InfoTable:GetCell('Size', i) ~= Vector2(0, 0) then\r\n                tSize = InfoTable:GetCell('Size', i)\r\n            end\r\n            if InfoTable:GetCell('AnchorsX', i) ~= Vector2(0, 0) then\r\n                tAnchorsX = InfoTable:GetCell('AnchorsX', i)\r\n            end\r\n            if InfoTable:GetCell('AnchorsY', i) ~= Vector2(0, 0) then\r\n                tAnchorsY = InfoTable:GetCell('AnchorsY', i)\r\n            end\r\n            if InfoTable:GetCell('Angle', i) ~= 0 then\r\n                tAngle = InfoTable:GetCell('Angle', i)\r\n            end\r\n            if InfoTable:GetCell('Offset', i) ~= Vector2(0, 0) then\r\n                tOffset = InfoTable:GetCell('Offset', i)\r\n            end\r\n            if InfoTable:GetCell('Alpha', i) ~= 0 then\r\n                tAlpha = InfoTable:GetCell('Alpha', i)\r\n            end\r\n            if InfoTable:GetCell('Tag', i) ~= '' then\r\n                tTag = InfoTable:GetCell('Tag', i)\r\n            end\r\n\r\n            OneFrame = {\r\n                Frame = tFrame,\r\n                Size = tSize,\r\n                AnchorsX = tAnchorsX,\r\n                AnchorsY = tAnchorsY,\r\n                Angle = tAngle,\r\n                Offset = tOffset,\r\n                Alpha = tAlpha,\r\n                Tag = tTag,\r\n                Type = tType\r\n            }\r\n            table.insert(self.Data[AnimationName][PathStr].KeyFrame, OneFrame)\r\n        end\r\n    end\r\nend\r\n\r\nfunction DataModule:Calculate(DataName)\r\n    for k, v in pairs(self.Data[DataName]) do\r\n        local NowKeyFrame = 0\r\n        local NextKeyFrame = 0\r\n        if k ~= 'count' then\r\n            --Tag\r\n            for i = 1, #v.KeyFrame do\r\n                if v.KeyFrame[i].Tag then\r\n                    if v.PerFrame[v.KeyFrame[i].Frame] == nil then\r\n                        v.PerFrame[v.KeyFrame[i].Frame] = {}\r\n                    end\r\n                    v.PerFrame[v.KeyFrame[i].Frame].Tag = v.KeyFrame[i].Tag\r\n                end\r\n            end\r\n\r\n            --Alpha\r\n            for i = 1, #v.KeyFrame do\r\n                if v.KeyFrame[i].Alpha then\r\n                    NowKeyFrame = i\r\n                    NextKeyFrame = i\r\n                    break\r\n                end\r\n            end\r\n            if NowKeyFrame ~= 0 then\r\n                while next(v.KeyFrame, NextKeyFrame) do\r\n                    local _, temp = next(v.KeyFrame, NextKeyFrame)\r\n                    NextKeyFrame = next(v.KeyFrame, NextKeyFrame)\r\n                    if temp.Alpha then\r\n                        local n = v.KeyFrame[NowKeyFrame].Frame\r\n                        local Count = v.KeyFrame[NextKeyFrame].Frame - v.KeyFrame[NowKeyFrame].Frame\r\n                        local PerFrame =\r\n                            DataModule:Interpolation(\r\n                            v.KeyFrame[NowKeyFrame].Alpha,\r\n                            v.KeyFrame[NowKeyFrame].Type,\r\n                            v.KeyFrame[NextKeyFrame].Alpha,\r\n                            v.KeyFrame[NextKeyFrame].Type,\r\n                            Count\r\n                        )\r\n                        for i = n + 1, n + Count do\r\n                            if v.PerFrame[i] == nil then\r\n                                v.PerFrame[i] = {}\r\n                            end\r\n                            v.PerFrame[i].Alpha = PerFrame[i - n]\r\n                        end\r\n                        NowKeyFrame = NextKeyFrame\r\n                    end\r\n                end\r\n            end\r\n\r\n            --Offset\r\n            NowKeyFrame = 0\r\n            for i = 1, #v.KeyFrame do\r\n                if v.KeyFrame[i].Offset then\r\n                    NowKeyFrame = i\r\n                    NextKeyFrame = i\r\n                    break\r\n                end\r\n            end\r\n            if NowKeyFrame ~= 0 then\r\n                while next(v.KeyFrame, NextKeyFrame) do\r\n                    local _, temp = next(v.KeyFrame, NextKeyFrame)\r\n                    NextKeyFrame = next(v.KeyFrame, NextKeyFrame)\r\n                    if temp.Offset then\r\n                        local n = v.KeyFrame[NowKeyFrame].Frame\r\n                        local Count = v.KeyFrame[NextKeyFrame].Frame - v.KeyFrame[NowKeyFrame].Frame\r\n                        local PerFrame =\r\n                            DataModule:Interpolation(\r\n                            v.KeyFrame[NowKeyFrame].Offset,\r\n                            v.KeyFrame[NowKeyFrame].Type,\r\n                            v.KeyFrame[NextKeyFrame].Offset,\r\n                            v.KeyFrame[NextKeyFrame].Type,\r\n                            Count\r\n                        )\r\n                        for i = n + 1, n + Count do\r\n                            if v.PerFrame[i] == nil then\r\n                                v.PerFrame[i] = {}\r\n                            end\r\n                            v.PerFrame[i].Offset = PerFrame[i - n]\r\n                        end\r\n                        NowKeyFrame = NextKeyFrame\r\n                    end\r\n                end\r\n            end\r\n\r\n            --Size\r\n            NowKeyFrame = 0\r\n            for i = 1, #v.KeyFrame do\r\n                if v.KeyFrame[i].Size then\r\n                    NowKeyFrame = i\r\n                    NextKeyFrame = i\r\n                    break\r\n                end\r\n            end\r\n            if NowKeyFrame ~= 0 then\r\n                while next(v.KeyFrame, NextKeyFrame) do\r\n                    local _, temp = next(v.KeyFrame, NextKeyFrame)\r\n                    NextKeyFrame = next(v.KeyFrame, NextKeyFrame)\r\n                    if temp.Size then\r\n                        local n = v.KeyFrame[NowKeyFrame].Frame\r\n                        local Count = v.KeyFrame[NextKeyFrame].Frame - v.KeyFrame[NowKeyFrame].Frame\r\n                        local PerFrame =\r\n                            DataModule:Interpolation(\r\n                            v.KeyFrame[NowKeyFrame].Size,\r\n                            v.KeyFrame[NowKeyFrame].Type,\r\n                            v.KeyFrame[NextKeyFrame].Size,\r\n                            v.KeyFrame[NextKeyFrame].Type,\r\n                            Count\r\n                        )\r\n                        for i = n + 1, n + Count do\r\n                            if v.PerFrame[i] == nil then\r\n                                v.PerFrame[i] = {}\r\n                            end\r\n                            v.PerFrame[i].Size = PerFrame[i - n]\r\n                        end\r\n                        NowKeyFrame = NextKeyFrame\r\n                    end\r\n                end\r\n            end\r\n\r\n            --AnchorsX\r\n            NowKeyFrame = 0\r\n            for i = 1, #v.KeyFrame do\r\n                if v.KeyFrame[i].AnchorsX then\r\n                    NowKeyFrame = i\r\n                    NextKeyFrame = i\r\n                    break\r\n                end\r\n            end\r\n            if NowKeyFrame ~= 0 then\r\n                while next(v.KeyFrame, NextKeyFrame) do\r\n                    local _, temp = next(v.KeyFrame, NextKeyFrame)\r\n                    NextKeyFrame = next(v.KeyFrame, NextKeyFrame)\r\n                    if temp.AnchorsX then\r\n                        local n = v.KeyFrame[NowKeyFrame].Frame\r\n                        local Count = v.KeyFrame[NextKeyFrame].Frame - v.KeyFrame[NowKeyFrame].Frame\r\n                        local PerFrame =\r\n                            DataModule:Interpolation(\r\n                            v.KeyFrame[NowKeyFrame].AnchorsX,\r\n                            v.KeyFrame[NowKeyFrame].Type,\r\n                            v.KeyFrame[NextKeyFrame].AnchorsX,\r\n                            v.KeyFrame[NextKeyFrame].Type,\r\n                            Count\r\n                        )\r\n                        for i = n + 1, n + Count do\r\n                            if v.PerFrame[i] == nil then\r\n                                v.PerFrame[i] = {}\r\n                            end\r\n                            v.PerFrame[i].AnchorsX = PerFrame[i - n]\r\n                        end\r\n                        NowKeyFrame = NextKeyFrame\r\n                    end\r\n                end\r\n            end\r\n\r\n            --AnchorsY\r\n            NowKeyFrame = 0\r\n            for i = 1, #v.KeyFrame do\r\n                if v.KeyFrame[i].AnchorsY then\r\n                    NowKeyFrame = i\r\n                    NextKeyFrame = i\r\n                    break\r\n                end\r\n            end\r\n            if NowKeyFrame ~= 0 then\r\n                while next(v.KeyFrame, NextKeyFrame) do\r\n                    local _, temp = next(v.KeyFrame, NextKeyFrame)\r\n                    NextKeyFrame = next(v.KeyFrame, NextKeyFrame)\r\n                    if temp.AnchorsY then\r\n                        local n = v.KeyFrame[NowKeyFrame].Frame\r\n                        local Count = v.KeyFrame[NextKeyFrame].Frame - v.KeyFrame[NowKeyFrame].Frame\r\n                        local PerFrame =\r\n                            DataModule:Interpolation(\r\n                            v.KeyFrame[NowKeyFrame].AnchorsY,\r\n                            v.KeyFrame[NowKeyFrame].Type,\r\n                            v.KeyFrame[NextKeyFrame].AnchorsY,\r\n                            v.KeyFrame[NextKeyFrame].Type,\r\n                            Count\r\n                        )\r\n                        for i = n + 1, n + Count do\r\n                            if v.PerFrame[i] == nil then\r\n                                v.PerFrame[i] = {}\r\n                            end\r\n                            v.PerFrame[i].AnchorsY = PerFrame[i - n]\r\n                        end\r\n                        NowKeyFrame = NextKeyFrame\r\n                    end\r\n                end\r\n            end\r\n\r\n            --Angle\r\n            NowKeyFrame = 0\r\n            for i = 1, #v.KeyFrame do\r\n                if v.KeyFrame[i].Angle then\r\n                    NowKeyFrame = i\r\n                    NextKeyFrame = i\r\n                    break\r\n                end\r\n            end\r\n            if NowKeyFrame ~= 0 then\r\n                while next(v.KeyFrame, NextKeyFrame) do\r\n                    local _, temp = next(v.KeyFrame, NextKeyFrame)\r\n                    NextKeyFrame = next(v.KeyFrame, NextKeyFrame)\r\n                    if temp.Angle then\r\n                        local n = v.KeyFrame[NowKeyFrame].Frame\r\n                        local Count = v.KeyFrame[NextKeyFrame].Frame - v.KeyFrame[NowKeyFrame].Frame\r\n                        local PerFrame =\r\n                            DataModule:Interpolation(\r\n                            v.KeyFrame[NowKeyFrame].Angle,\r\n                            v.KeyFrame[NowKeyFrame].Type,\r\n                            v.KeyFrame[NextKeyFrame].Angle,\r\n                            v.KeyFrame[NextKeyFrame].Type,\r\n                            Count\r\n                        )\r\n                        for i = n + 1, n + Count do\r\n                            if v.PerFrame[i] == nil then\r\n                                v.PerFrame[i] = {}\r\n                            end\r\n                            v.PerFrame[i].Angle = PerFrame[i - n]\r\n                        end\r\n                        NowKeyFrame = NextKeyFrame\r\n                    end\r\n                end\r\n            end\r\n        end\r\n    end\r\nend\r\n\r\nfunction DataModule:Interpolation(_ParaOne, _TypeOne, _ParaTwo, _TypeTwo, _Count)\r\n    local Result = {}\r\n    if _TypeOne == 'Linear' and _TypeTwo == 'Linear' then\r\n        for i = 1, _Count do\r\n            local Frame = _ParaOne * (_Count - i) / _Count + _ParaTwo * i / _Count\r\n            table.insert(Result, Frame)\r\n        end\r\n    end\r\n    return Result\r\nend\r\n\r\nreturn DataModule\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cFolderObject","name":"Define","guid":[3643209718,4192551772,2636302611,3473650035],"parentGuid":[344576033,1668630255,2683907297,2226597768],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Define"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cModuleScriptObject","name":"GlobalDefModule","guid":[3584163079,3374337710,2390188471,2399437392],"parentGuid":[3643209718,4192551772,2636302611,3473650035],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"GlobalDefModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 全局变量的定义,全部定义在GlobalDef这张表下面,用于全局可修改的参数\r\n-- @module Global Defines\r\n-- @copyright Lilith Games, Avatar Team\r\nlocal GlobalDef = {}\r\n\r\n-- e.g. (need DELETE)\r\nGlobalDef.a = 123\r\n\r\nGlobalDef.b = {\r\n    tom = '1231',\r\n    bob = '23423'\r\n}\r\n\r\n-- TODO: other constant defines\r\n\r\nreturn GlobalDef\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cModuleScriptObject","name":"ConstDefModule","guid":[1768866970,2821735027,2612949907,3460044805],"parentGuid":[3643209718,4192551772,2636302611,3473650035],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ConstDefModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 全局常量的定义,全部定义在ConstDef这张表下面,用于定义全局常量参数或者枚举类型\r\n-- @module Constant Defines\r\n-- @copyright Lilith Games, Avatar Team\r\nlocal ConstDef = {}\r\n\r\n-- e.g. (need DELETE)\r\nConstDef.MAX_PLAYERS = 4\r\n\r\nConstDef.MonsterTypeEnum = {\r\n    FOE = 0,\r\n    VILLAGER = 1,\r\n    BOSS = 2\r\n}\r\n\r\n-- TODO: other constant defines\r\n\r\nreturn ConstDef\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cFolderObject","name":"Module","guid":[2883110320,3875490972,2778882821,1569891889],"parentGuid":[344576033,1668630255,2683907297,2226597768],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Module"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cFolderObject","name":"S_Module","guid":[2325219688,3448000480,2204321929,4246846969],"parentGuid":[2883110320,3875490972,2778882821,1569891889],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"S_Module"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cModuleScriptObject","name":"GameMgrModule","guid":[112830824,171854255,2946136964,1894336579],"parentGuid":[2325219688,3448000480,2204321929,4246846969],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"GameMgrModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 游戏服务器主逻辑\r\n-- @module Game Manager, Server-side\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author XXX, XXXX\r\nlocal GameMgr, this =\r\n    {\r\n        isRun = false,\r\n        dt = 0, -- delta time 每帧时间\r\n        tt = 0 -- total time 游戏总时间\r\n    },\r\n    nil\r\n\r\n--- 初始化\r\nfunction GameMgr:Init()\r\n    print('[信息] GameMgr:Init')\r\n    this = self\r\n    self:InitListeners()\r\n\r\n    -- TODO: 其他服务器模块初始化\r\n    ExampleA:Init()\r\n    CsvConfig:Init()\r\nend\r\n\r\n--- 初始化Game Manager自己的监听事件\r\nfunction GameMgr:InitListeners()\r\n    EventUtil.LinkConnects(world.S_Event, GameMgr, 'GameMgr', this)\r\nend\r\n\r\n--- Update函数\r\n-- @param dt delta time 每帧时间\r\nfunction GameMgr:Update(dt)\r\n    -- TODO: 其他服务器模块Update\r\n    ExampleA:Update(dt)\r\nend\r\n\r\nfunction GameMgr:StartUpdate()\r\n    print('[信息] GameMgr:StartUpdate')\r\n    if self.isRun then\r\n        print('[警告] GameMgr:StartUpdate 正在运行')\r\n        return\r\n    end\r\n\r\n    self.isRun = true\r\n\r\n    while (self.isRun) do\r\n        self.dt = wait()\r\n        self.tt = self.tt + self.dt\r\n        self:Update(self.dt)\r\n    end\r\nend\r\n\r\nfunction GameMgr:StopUpdate()\r\n    print('[信息] GameMgr:StopUpdate')\r\n    self.isRun = false\r\nend\r\n\r\n--- TEST ONLY 处理Example01CustomEvent事件\r\n-- 函数命名格式为 事件名 + 'Handler'\r\nfunction GameMgr:Example01CustomEventHandler()\r\n    print('[信息] 收到Example01CustomEvent')\r\n    self:StartUpdate()\r\nend\r\n\r\n--- TEST ONLY 处理Example02CustomEvent事件\r\n-- 函数命名格式为 事件名 + 'Handler'\r\nfunction GameMgr:Example02CustomEventHandler()\r\n    print('[信息] 收到Example02CustomEvent')\r\n    print('打印预加载的表格Example01,单一主键')\r\n    table.dump(CsvConfig.Example01)\r\n    print('打印预加载的表格Example01,多主键')\r\n    table.dump(CsvConfig.Example02)\r\nend\r\n\r\n--- TEST ONLY 处理Example02CustomEvent事件\r\n-- 函数命名格式为 事件名 + 'Handler'\r\nfunction GameMgr:Example03CustomEventHandler()\r\n    print('[信息] 收到Example03CustomEvent')\r\n    self:StopUpdate()\r\nend\r\n\r\nreturn GameMgr\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cModuleScriptObject","name":"CsvConfigModule","guid":[112798298,387337249,2420484563,3059665706],"parentGuid":[2325219688,3448000480,2204321929,4246846969],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"CsvConfigModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 游戏表格处理\r\n-- @module Csv Config Load\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author Yuancheng Zhang\r\nlocal CsvConfig = {\r\n    -- TEST ONLY 需要预先加载为Lua Table的表格名称\r\n    preLoad = {\r\n        {\r\n            csv = 'Example01',\r\n            id = 'Type',\r\n            isPrimary = true\r\n        },\r\n        {\r\n            csv = 'Example02',\r\n            id = 'enemy_id',\r\n            isPrimary = false\r\n        }\r\n    }\r\n}\r\n\r\n--- 初始化:加载所有预加载表格\r\nfunction CsvConfig:Init()\r\n    print('[信息] CsvConfig:Init')\r\n    self:PreloadCsv()\r\nend\r\n\r\nfunction CsvConfig:PreloadCsv()\r\n    print('[信息] CsvConfig:PreloadCsv')\r\n    for _, pl in pairs(self.preLoad) do\r\n        if not string.isnilorempty(pl.csv) and not string.isnilorempty(pl.id) then\r\n            self[pl.csv] = CsvUtil.GetCsvInfo(Csv[pl.csv], pl.id, pl.isPrimary)\r\n        end\r\n    end\r\nend\r\n\r\nreturn CsvConfig\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cModuleScriptObject","name":"ExampleAModule","guid":[2387834855,1574587674,2670415526,3557140699],"parentGuid":[2325219688,3448000480,2204321929,4246846969],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ExampleAModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 样例模块(看后删掉)\r\n-- @module Module Example A\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author XXX, XXXX\r\nlocal ExampleA, this = {}, nil\r\n\r\n--- 初始化\r\nfunction ExampleA:Init()\r\n    print('[信息] ExampleA:Init')\r\n    this = self\r\n    self:InitListeners()\r\nend\r\n\r\n--- 初始化Game Manager自己的监听事件\r\nfunction ExampleA:InitListeners()\r\n    EventUtil.LinkConnects(world.S_Event, ExampleA, 'ExampleA', this)\r\nend\r\n\r\n--- Update函数\r\n-- @param dt delta time 每帧时间\r\nfunction ExampleA:Update(dt)\r\n    --print(string.format('[测试] 模块:%s, deltaTime = %.4f', 'ExampleA', dt))\r\nend\r\n\r\nreturn ExampleA\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cFolderObject","name":"C_Module","guid":[2085024476,779046503,2599607412,4053327341],"parentGuid":[2883110320,3875490972,2778882821,1569891889],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"C_Module"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cModuleScriptObject","name":"PlayerMgrModule","guid":[1039137540,2610905714,3183561849,1647783672],"parentGuid":[2085024476,779046503,2599607412,4053327341],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"PlayerMgrModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 游戏客户端主逻辑\r\n-- @module Game Manager, Client-side\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author XXX, XXXX\r\nlocal PlayerMgr, this =\r\n    {\r\n        dt = 0,\r\n        tt = 0,\r\n        isRun = false\r\n    },\r\n    nil\r\n\r\n--- 初始化\r\nfunction PlayerMgr:Init()\r\n    print('[信息] PlayerMgr:Init')\r\n    this = self\r\n    self:InitListeners()\r\n\r\n    -- TODO: 其他客户端模块初始化\r\n    ExampleB:Init()\r\nend\r\n\r\n--- 初始化Game Manager自己的监听事件\r\nfunction PlayerMgr:InitListeners()\r\n    EventUtil.LinkConnects(localPlayer.C_Event, PlayerMgr, 'PlayerMgr', this)\r\nend\r\n\r\n--- Update函数\r\n-- @param dt delta time 每帧时间\r\nfunction PlayerMgr:Update(dt)\r\n    -- TODO: 其他客户端模块Update\r\n    ExampleB:Update(dt)\r\nend\r\n\r\nfunction PlayerMgr:StartUpdate()\r\n    print('[信息] PlayerMgr:StartUpdate')\r\n    if self.isRun then\r\n        print('[警告] PlayerMgr:StartUpdate 正在运行')\r\n        return\r\n    end\r\n\r\n    self.isRun = true\r\n\r\n    while (self.isRun) do\r\n        self.dt = wait()\r\n        self.tt = self.tt + self.dt\r\n        self:Update(self.dt)\r\n    end\r\nend\r\n\r\nfunction PlayerMgr:StopUpdate()\r\n    print('[信息] PlayerMgr:StopUpdate')\r\n    self.isRun = false\r\nend\r\n\r\n--- TEST ONLY 处理ClientExample01Event事件\r\n-- 函数命名格式为 事件名 + 'Handler'\r\nfunction PlayerMgr:ClientExample01EventHandler(arg1)\r\n    print('[信息] 收到ClientExample01Event, 参数:', arg1)\r\n    self:StartUpdate()\r\nend\r\n\r\nreturn PlayerMgr\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cModuleScriptObject","name":"ExampleBModule","guid":[646356249,1292323580,2768118403,2865367294],"parentGuid":[2085024476,779046503,2599607412,4053327341],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ExampleBModule"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 样例模块(看后删掉)\r\n-- @module Module Example A\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author XXX, XXXX\r\nlocal ExampleB, this = {}, nil\r\n\r\n--- 初始化\r\nfunction ExampleB:Init()\r\n    print('[信息] ExampleB:Init')\r\n    this = self\r\n    self:InitListeners()\r\nend\r\n\r\n--- 初始化Game Manager自己的监听事件\r\nfunction ExampleB:InitListeners()\r\n    EventUtil.LinkConnects(localPlayer.C_Event, ExampleB, 'ExampleB', this)\r\nend\r\n\r\n--- Update函数\r\n-- @param dt delta time 每帧时间\r\nfunction ExampleB:Update(dt)\r\n    --print(string.format('[测试] 模块:%s, deltaTime = %.4f', 'ExampleB', dt))\r\nend\r\n\r\n--- TEST ONLY 处理Example02CustomEvent事件\r\n-- 函数命名格式为 事件名 + 'Handler'\r\nfunction ExampleB:Example02CustomEventHandler(arg1)\r\n    print('[信息] 收到Example02CustomEvent, 参数:', arg1)\r\n    localPlayer.Local.FUNC_UIAnimation.StartAnimationEvent:Fire('TestAnimation')\r\nend\r\n\r\nreturn ExampleB\r\n","m_scriptType":"kModuleScript"}}]},{"class":"cFolderObject","name":"Csv","guid":[2272249561,3378007281,2688214392,3190071702],"parentGuid":[344576033,1668630255,2683907297,2226597768],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Csv"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cTableObject","name":"UIAnimation","guid":[1097962876,3754445060,2192136032,4179300550],"parentGuid":[2272249561,3378007281,2688214392,3190071702],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"UIAnimation"}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":310,"class":"sTableComponent","data":{"m_dataModel":{"m_rowNum":9,"m_columnNum":14,"m_tableData":[["Type","String","Int","String","Boolean","Int","Vector2","Vector2","Vector2","Float","Vector2","Float","String","String"],["","AnimationName","Count","UINode","IsInit","KeyFrame","Size","AnchorsX","AnchorsY","Angle","Offset","Alpha","Tag","Type"],["1","TestAnimation","12","Local.ScreenGUI.JumpButton","TRUE","0","","","","90","0,-100","","",""],["2","TestAnimation","","Local.ScreenGUI.JumpButton","","1","","","","90","0,-100","","Tag1","Linear"],["3","TestAnimation","","Local.ScreenGUI.JumpButton","","10","","","","0.1","0,-1","","","Linear"],["4","TestAnimation","","Local.ScreenGUI.Joystick","TRUE","0","0,1","","","","","","",""],["5","TestAnimation","","Local.ScreenGUI.Joystick","","1","0,1","","","","","","","Linear"],["6","TestAnimation","","Local.ScreenGUI.Joystick","","10","350,350","","","","","","","Linear"],["7","TestAnimation","","Local.ScreenGUI.Joystick","","12","300,300","","","","","","","Linear"]]}}}]},{"class":"cTableObject","name":"Example01","guid":[1009384381,1318601170,2335100178,2096260731],"parentGuid":[2272249561,3378007281,2688214392,3190071702],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Example01"}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":310,"class":"sTableComponent","data":{"m_dataModel":{"m_rowNum":6,"m_columnNum":4,"m_tableData":[["Type","String","String","Int"],["","level_id","level_name","reward"],["1","easy_01","Level 01","100"],["2","easy_02","Level 02","140"],["3","hard_01","Level 03","280"],["4","hard_02","Level 04","320"]]}}}]},{"class":"cTableObject","name":"Example02","guid":[519619536,3748807551,2763899961,330082025],"parentGuid":[2272249561,3378007281,2688214392,3190071702],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Example02"}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":310,"class":"sTableComponent","data":{"m_dataModel":{"m_rowNum":6,"m_columnNum":4,"m_tableData":[["Type","String","String","Int"],["","enemy_id","difficulty","hp"],["1","foe_01","easy","100"],["2","foe_01","hard","150"],["3","foe_02","easy","300"],["4","foe_02","hard","400"]]}}}]},{"class":"cFolderObject","name":"S_Event","guid":[3388698598,504056136,2819280548,3600804874],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"S_Event"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cCustomEventObject","name":"Example01CustomEvent","guid":[1849321353,1174686080,2581212444,423150465],"parentGuid":[3388698598,504056136,2819280548,3600804874],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Example01CustomEvent"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":511,"class":"sCustomEventComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--自定义事件脚本, 会监听由FireEventTo系列触发的与该脚本名一样的事件\r\n--参数(arg1, arg2, arg3 ...) : 为各个事件参数\r\n","m_scriptType":"kCustomFunction"}}]},{"class":"cCustomEventObject","name":"Example02CustomEvent","guid":[2464372298,3888661849,2219280214,4227873962],"parentGuid":[3388698598,504056136,2819280548,3600804874],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Example02CustomEvent"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":511,"class":"sCustomEventComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--自定义事件脚本, 会监听由FireEventTo系列触发的与该脚本名一样的事件\r\n--参数(arg1, arg2, arg3 ...) : 为各个事件参数\r\n","m_scriptType":"kCustomFunction"}}]},{"class":"cCustomEventObject","name":"Example03CustomEvent","guid":[3522954919,4107421185,2760879892,839023523],"parentGuid":[3388698598,504056136,2819280548,3600804874],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Example03CustomEvent"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":511,"class":"sCustomEventComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--自定义事件脚本, 会监听由FireEventTo系列触发的与该脚本名一样的事件\r\n--参数(arg1, arg2, arg3 ...) : 为各个事件参数\r\n","m_scriptType":"kCustomFunction"}}]},{"class":"cFolderObject","name":"S_Code","guid":[3588299831,2838581107,2638019367,1912244102],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"S_Code"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cScriptObject","name":"ServerMain","guid":[3478165892,3968682922,3091200964,3154749412],"parentGuid":[3588299831,2838581107,2638019367,1912244102],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"ServerMain"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sLuaComponent","data":{"m_luaContent":"--- 服务器代码入口\r\n-- @script Server Main Function\r\n-- @copyright Lilith Games, Avatar Team\r\n-- @author XXX, XXX\r\n\r\nGameMgr:Init()\r\n-- invoke(\r\n--     function()\r\n--         GameMgr:StartUpdate()\r\n--     end\r\n-- )\r\n\r\n-- TEST ONLY BELOW\r\nwait(1)\r\ninvoke(\r\n    function()\r\n        NetUtil.Fire_S('Example01CustomEvent')\r\n    end\r\n)\r\n\r\nwait(1)\r\ninvoke(\r\n    function()\r\n        for _, p in pairs(world:FindPlayers()) do\r\n            NetUtil.Fire_C('ClientExample01Event', p, p.Name)\r\n            NetUtil.Fire_C('ClientExample02Event', p)\r\n        end\r\n    end\r\n)\r\n\r\nwait(1)\r\ninvoke(\r\n    function()\r\n        NetUtil.Fire_S('Example02CustomEvent')\r\n    end\r\n)\r\n\r\nwait(1)\r\ninvoke(\r\n    function()\r\n        NetUtil.Fire_S('Example03CustomEvent')\r\n    end\r\n)\r\n"}}]},{"class":"cPrimitiveObject","name":"BaseFloor","guid":[4211227124,399589691,2212667733,3335218667],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[0.0,-0.20000000298023225,0.0]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"BaseFloor"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sBasicShapeComponent","data":{"m_size":[50.0,0.20000000298023225,50.0]}},{"id":12,"class":"sRigidBodyComponent","data":{"m_density":2400.0,"m_frictionRate":0.4000000059604645,"m_rough":0.44999998807907107,"m_restitution":0.44999998807907107}},{"id":13,"class":"sMaterialComponent","data":{"m_uvScale":3.0,"m_materialType":"kSubwayTiles"}},{"id":30,"class":"sRenderComponent","data":{}},{"id":3,"class":"sSizeComponent","data":{}},{"id":666,"class":"sStateSyncComponent","data":{}}]},{"class":"cFolderObject","name":"SpawnLocations","guid":[1803916521,3674621259,2355104850,441818688],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"SpawnLocations"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cStartPortal","name":"StartPortal00","guid":[362184257,1300644271,2169624314,2670603163],"parentGuid":[1803916521,3674621259,2355104850,441818688],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[10.0,0.5,-10.0],"m_localRotation":[0.0,-0.3826834559440613,-0.0,0.9238795042037964]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"StartPortal00"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sStartPortalComponent","data":{}}]},{"class":"cStartPortal","name":"StartPortal01","guid":[651144420,800934336,3039799213,1377036607],"parentGuid":[1803916521,3674621259,2355104850,441818688],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[10.0,0.5,10.0],"m_localRotation":[0.0,0.9238795638084412,0.0,-0.3826834559440613]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"StartPortal01"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sStartPortalComponent","data":{}}]},{"class":"cStartPortal","name":"StartPortal02","guid":[4009425966,1206468687,2439525561,4287493119],"parentGuid":[1803916521,3674621259,2355104850,441818688],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[-10.0,0.5,-10.0],"m_localRotation":[0.0,0.3826834559440613,0.0,0.9238795042037964]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"StartPortal02"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sStartPortalComponent","data":{}}]},{"class":"cStartPortal","name":"StartPortal03","guid":[3415283602,2930724749,3175953031,3420113780],"parentGuid":[1803916521,3674621259,2355104850,441818688],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[-10.0,0.5,10.0],"m_localRotation":[0.0,0.9238795638084412,0.0,0.3826834559440613]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"StartPortal03"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sStartPortalComponent","data":{}}]},{"class":"cAudioSource","name":"BGM","guid":[1596674502,2319271992,2900844459,2801180766],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[1.1754943508222876e-38,1.1754943508222876e-38,1.1754943508222876e-38]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"BGM"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sAudioSourceComponent","data":{"m_soundtype":"k2D","m_soundclip":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false}}}]},{"class":"cSkydome","name":"Sky","guid":[3956874685,1991789763,3220541584,1456680764],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sRegularTransform","data":{"m_localPosition":[1.1754943508222876e-38,1.1754943508222876e-38,1.1754943508222876e-38]}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Sky"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sSkydomeComponent","data":{"m_front":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_back":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_left":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_right":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_up":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_down":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_ambient":[0.501960813999176,0.501960813999176,0.501960813999176,1.0],"m_latitude":45.0}},{"id":11,"class":"sDateTimeComponent","data":{}},{"id":12,"class":"sFogComponent","data":{}}]},{"class":"cFolderObject","name":"Players","guid":[3397398191,850542637,3138524115,1333674022],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sIdentityTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Players"}},{"id":40000,"class":"sScriptHelperComponent","data":{}}]},{"class":"cPlayerInstanceSlot","name":"PlayerInstanceSlot","guid":[718760084,1257915969,2962466066,2150526306],"parentGuid":[3397398191,850542637,3138524115,1333674022],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"PlayerInstanceSlot"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sPlayerInstanceSlotComponent","data":{"m_archetype":[2229867806,259017539,2476631306,1972820229]}}]},{"class":"cPlayerInstanceSlot","name":"PlayerInstanceSlot","guid":[438081159,4019275113,2394302102,997050187],"parentGuid":[3397398191,850542637,3138524115,1333674022],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"PlayerInstanceSlot"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sPlayerInstanceSlotComponent","data":{"m_archetype":[2229867806,259017539,2476631306,1972820229]}}]},{"class":"cPlayerInstanceSlot","name":"PlayerInstanceSlot","guid":[154289415,229392516,2254790969,287930189],"parentGuid":[3397398191,850542637,3138524115,1333674022],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"PlayerInstanceSlot"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":10,"class":"sPlayerInstanceSlotComponent","data":{"m_archetype":[2229867806,259017539,2476631306,1972820229]}}]},{"class":"cTerrainObject","name":"Terrain","guid":[2381081137,2979483093,3156488065,1492146101],"parentGuid":[1981988479,3555894,2597800867,69741929],"components":[{"id":0,"class":"sRegularTransform","data":{}},{"id":2,"class":"sObjectDataComponent","data":{"m_name":"Terrain"}},{"id":19,"class":"sNetworkComponent","data":{}},{"id":40000,"class":"sScriptHelperComponent","data":{}},{"id":610,"class":"sTerrainComponent","data":{"m_memStreamBuffer":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_memStreamBuffer2":{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},"m_memWaterStreamBuffer":[{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false},{"m_guid":[0,0,0,0],"m_revision":-1,"m_type":"kGeneric","m_autoGenerated":false}],"m_emptyPlaceholder":true}},{"id":13,"class":"sRenderComponent","data":{}},{"id":15,"class":"sRigidBodyComponent","data":{"m_frictionRate":0.44999998807907107,"m_rough":0.4000000059604645,"m_restitution":0.30000001192092898}}]}]}]}